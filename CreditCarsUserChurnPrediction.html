<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>08f8c02c6cfc4556b0e4402233deb884</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="9a54fa0f" class="cell markdown" id="9a54fa0f">
<h1 id="credit-card-users-churn-prediction">Credit Card Users Churn
Prediction</h1>
</div>
<div id="2dc7da7a" class="cell markdown" id="2dc7da7a">
<h3 id="importing-libraries">Importing Libraries</h3>
</div>
<div id="9285c399" class="cell code" id="9285c399"
data-outputId="b52aca85-ec8b-4f33-c496-a09aae289699">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will help in making the Python code more structured automatically (good coding practice)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext nb_black</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries to help with reading and manipulating data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Libaries to help with data visualization</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># To tune model, get different metric scores, and split data</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    f1_score,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    accuracy_score,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    recall_score,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    precision_score,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    confusion_matrix,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    roc_auc_score,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    plot_confusion_matrix,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, StratifiedKFold, cross_val_score</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># To be used for data scaling and one hot encoding</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, MinMaxScaler, OneHotEncoder</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># To impute missing values</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># To oversample and undersample data</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.under_sampling <span class="im">import</span> RandomUnderSampler</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># To do hyperparameter tuning</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># To be used for creating pipelines and personalizing them</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># To define maximum number of columns to be displayed in a dataframe</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&quot;display.max_columns&quot;</span>, <span class="va">None</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># To supress scientific notations for a dataframe</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&quot;display.float_format&quot;</span>, <span class="kw">lambda</span> x: <span class="st">&quot;</span><span class="sc">%.3f</span><span class="st">&quot;</span> <span class="op">%</span> x)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># To help with model building</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> (</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    AdaBoostClassifier,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    GradientBoostingClassifier,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    RandomForestClassifier,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    BaggingClassifier,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co"># To suppress scientific notations</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&quot;display.float_format&quot;</span>, <span class="kw">lambda</span> x: <span class="st">&quot;</span><span class="sc">%.3f</span><span class="st">&quot;</span> <span class="op">%</span> x)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co"># To supress warnings</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&quot;ignore&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>The nb_black extension is already loaded. To reload it, use:
  %reload_ext nb_black
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="fff908f6" class="cell markdown" id="fff908f6">
<h3 id="loading-data">Loading Data</h3>
</div>
<div id="e2ad2a10" class="cell code" id="e2ad2a10"
data-outputId="0d3dbe84-e83f-493a-eca5-8d3d4f37411f">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>churn <span class="op">=</span> pd.read_csv(<span class="st">&quot;BankChurners.csv&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="03fa9004" class="cell code" id="03fa9004"
data-outputId="eca48be0-6bef-4a3f-df06-5a84a07f8d76">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the number of rows and columns in the data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>churn.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="3">
<pre><code>(10127, 21)</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="f0d32ab1" class="cell markdown" id="f0d32ab1">
<ul>
<li>The dataset has 10127 rows and 21 columns</li>
</ul>
</div>
<div id="30e0d897" class="cell markdown" id="30e0d897">
<h3 id="data-overview">Data Overview</h3>
</div>
<div id="45153b44" class="cell code" id="45153b44"
data-outputId="74a6c5bd-d399-4f85-e3e3-c5e1e78d6968">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s create a copy of the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> churn.copy()</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="c312eb85" class="cell code" id="c312eb85"
data-outputId="82905d6b-9d35-43d3-abc0-b3c857234cba"
data-scrolled="true">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s view the first 5 rows of the data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>data.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CLIENTNUM</th>
      <th>Attrition_Flag</th>
      <th>Customer_Age</th>
      <th>Gender</th>
      <th>Dependent_count</th>
      <th>Education_Level</th>
      <th>Marital_Status</th>
      <th>Income_Category</th>
      <th>Card_Category</th>
      <th>Months_on_book</th>
      <th>Total_Relationship_Count</th>
      <th>Months_Inactive_12_mon</th>
      <th>Contacts_Count_12_mon</th>
      <th>Credit_Limit</th>
      <th>Total_Revolving_Bal</th>
      <th>Avg_Open_To_Buy</th>
      <th>Total_Amt_Chng_Q4_Q1</th>
      <th>Total_Trans_Amt</th>
      <th>Total_Trans_Ct</th>
      <th>Total_Ct_Chng_Q4_Q1</th>
      <th>Avg_Utilization_Ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>768805383</td>
      <td>Existing Customer</td>
      <td>45</td>
      <td>M</td>
      <td>3</td>
      <td>High School</td>
      <td>Married</td>
      <td>$60K - $80K</td>
      <td>Blue</td>
      <td>39</td>
      <td>5</td>
      <td>1</td>
      <td>3</td>
      <td>12691.000</td>
      <td>777</td>
      <td>11914.000</td>
      <td>1.335</td>
      <td>1144</td>
      <td>42</td>
      <td>1.625</td>
      <td>0.061</td>
    </tr>
    <tr>
      <th>1</th>
      <td>818770008</td>
      <td>Existing Customer</td>
      <td>49</td>
      <td>F</td>
      <td>5</td>
      <td>Graduate</td>
      <td>Single</td>
      <td>Less than $40K</td>
      <td>Blue</td>
      <td>44</td>
      <td>6</td>
      <td>1</td>
      <td>2</td>
      <td>8256.000</td>
      <td>864</td>
      <td>7392.000</td>
      <td>1.541</td>
      <td>1291</td>
      <td>33</td>
      <td>3.714</td>
      <td>0.105</td>
    </tr>
    <tr>
      <th>2</th>
      <td>713982108</td>
      <td>Existing Customer</td>
      <td>51</td>
      <td>M</td>
      <td>3</td>
      <td>Graduate</td>
      <td>Married</td>
      <td>$80K - $120K</td>
      <td>Blue</td>
      <td>36</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>3418.000</td>
      <td>0</td>
      <td>3418.000</td>
      <td>2.594</td>
      <td>1887</td>
      <td>20</td>
      <td>2.333</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>769911858</td>
      <td>Existing Customer</td>
      <td>40</td>
      <td>F</td>
      <td>4</td>
      <td>High School</td>
      <td>NaN</td>
      <td>Less than $40K</td>
      <td>Blue</td>
      <td>34</td>
      <td>3</td>
      <td>4</td>
      <td>1</td>
      <td>3313.000</td>
      <td>2517</td>
      <td>796.000</td>
      <td>1.405</td>
      <td>1171</td>
      <td>20</td>
      <td>2.333</td>
      <td>0.760</td>
    </tr>
    <tr>
      <th>4</th>
      <td>709106358</td>
      <td>Existing Customer</td>
      <td>40</td>
      <td>M</td>
      <td>3</td>
      <td>Uneducated</td>
      <td>Married</td>
      <td>$60K - $80K</td>
      <td>Blue</td>
      <td>21</td>
      <td>5</td>
      <td>1</td>
      <td>0</td>
      <td>4716.000</td>
      <td>0</td>
      <td>4716.000</td>
      <td>2.175</td>
      <td>816</td>
      <td>28</td>
      <td>2.500</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="a638d79b" class="cell code" id="a638d79b"
data-outputId="ee8acf59-bcd2-4b3a-c5fb-d8e190b6ddcb"
data-scrolled="true">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s view the last 5 rows of the data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data.tail()</span></code></pre></div>
<div class="output execute_result" data-execution_count="6">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CLIENTNUM</th>
      <th>Attrition_Flag</th>
      <th>Customer_Age</th>
      <th>Gender</th>
      <th>Dependent_count</th>
      <th>Education_Level</th>
      <th>Marital_Status</th>
      <th>Income_Category</th>
      <th>Card_Category</th>
      <th>Months_on_book</th>
      <th>Total_Relationship_Count</th>
      <th>Months_Inactive_12_mon</th>
      <th>Contacts_Count_12_mon</th>
      <th>Credit_Limit</th>
      <th>Total_Revolving_Bal</th>
      <th>Avg_Open_To_Buy</th>
      <th>Total_Amt_Chng_Q4_Q1</th>
      <th>Total_Trans_Amt</th>
      <th>Total_Trans_Ct</th>
      <th>Total_Ct_Chng_Q4_Q1</th>
      <th>Avg_Utilization_Ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10122</th>
      <td>772366833</td>
      <td>Existing Customer</td>
      <td>50</td>
      <td>M</td>
      <td>2</td>
      <td>Graduate</td>
      <td>Single</td>
      <td>$40K - $60K</td>
      <td>Blue</td>
      <td>40</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>4003.000</td>
      <td>1851</td>
      <td>2152.000</td>
      <td>0.703</td>
      <td>15476</td>
      <td>117</td>
      <td>0.857</td>
      <td>0.462</td>
    </tr>
    <tr>
      <th>10123</th>
      <td>710638233</td>
      <td>Attrited Customer</td>
      <td>41</td>
      <td>M</td>
      <td>2</td>
      <td>NaN</td>
      <td>Divorced</td>
      <td>$40K - $60K</td>
      <td>Blue</td>
      <td>25</td>
      <td>4</td>
      <td>2</td>
      <td>3</td>
      <td>4277.000</td>
      <td>2186</td>
      <td>2091.000</td>
      <td>0.804</td>
      <td>8764</td>
      <td>69</td>
      <td>0.683</td>
      <td>0.511</td>
    </tr>
    <tr>
      <th>10124</th>
      <td>716506083</td>
      <td>Attrited Customer</td>
      <td>44</td>
      <td>F</td>
      <td>1</td>
      <td>High School</td>
      <td>Married</td>
      <td>Less than $40K</td>
      <td>Blue</td>
      <td>36</td>
      <td>5</td>
      <td>3</td>
      <td>4</td>
      <td>5409.000</td>
      <td>0</td>
      <td>5409.000</td>
      <td>0.819</td>
      <td>10291</td>
      <td>60</td>
      <td>0.818</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>10125</th>
      <td>717406983</td>
      <td>Attrited Customer</td>
      <td>30</td>
      <td>M</td>
      <td>2</td>
      <td>Graduate</td>
      <td>NaN</td>
      <td>$40K - $60K</td>
      <td>Blue</td>
      <td>36</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>5281.000</td>
      <td>0</td>
      <td>5281.000</td>
      <td>0.535</td>
      <td>8395</td>
      <td>62</td>
      <td>0.722</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>10126</th>
      <td>714337233</td>
      <td>Attrited Customer</td>
      <td>43</td>
      <td>F</td>
      <td>2</td>
      <td>Graduate</td>
      <td>Married</td>
      <td>Less than $40K</td>
      <td>Silver</td>
      <td>25</td>
      <td>6</td>
      <td>2</td>
      <td>4</td>
      <td>10388.000</td>
      <td>1961</td>
      <td>8427.000</td>
      <td>0.703</td>
      <td>10294</td>
      <td>61</td>
      <td>0.649</td>
      <td>0.189</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="109c91fa" class="cell code" id="109c91fa"
data-outputId="e2fb075a-e8c2-4310-e09f-bdb7288e87e9">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s check the data types of the columns in the dataset</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>data.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10127 entries, 0 to 10126
Data columns (total 21 columns):
 #   Column                    Non-Null Count  Dtype  
---  ------                    --------------  -----  
 0   CLIENTNUM                 10127 non-null  int64  
 1   Attrition_Flag            10127 non-null  object 
 2   Customer_Age              10127 non-null  int64  
 3   Gender                    10127 non-null  object 
 4   Dependent_count           10127 non-null  int64  
 5   Education_Level           8608 non-null   object 
 6   Marital_Status            9378 non-null   object 
 7   Income_Category           10127 non-null  object 
 8   Card_Category             10127 non-null  object 
 9   Months_on_book            10127 non-null  int64  
 10  Total_Relationship_Count  10127 non-null  int64  
 11  Months_Inactive_12_mon    10127 non-null  int64  
 12  Contacts_Count_12_mon     10127 non-null  int64  
 13  Credit_Limit              10127 non-null  float64
 14  Total_Revolving_Bal       10127 non-null  int64  
 15  Avg_Open_To_Buy           10127 non-null  float64
 16  Total_Amt_Chng_Q4_Q1      10127 non-null  float64
 17  Total_Trans_Amt           10127 non-null  int64  
 18  Total_Trans_Ct            10127 non-null  int64  
 19  Total_Ct_Chng_Q4_Q1       10127 non-null  float64
 20  Avg_Utilization_Ratio     10127 non-null  float64
dtypes: float64(5), int64(10), object(6)
memory usage: 1.6+ MB
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="7bca85d9" class="cell markdown" id="7bca85d9">
<ul>
<li>There are null values in the Education_Level and Marital_Status</li>
<li>5 columns are of object type rest all are numerical.</li>
</ul>
</div>
<div id="4f8a0f5b" class="cell code" id="4f8a0f5b"
data-outputId="5025505e-1c6e-4c44-a494-43749fe63c89">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s check for duplicate values in the data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>data.duplicated().<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">
<pre><code>0</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="362174a3" class="cell code" id="362174a3"
data-outputId="01ee706a-8d1c-4791-d7a1-40456222ba43">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s check for missing values in the data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">round</span>(data.isnull().<span class="bu">sum</span>() <span class="op">/</span> data.isnull().count() <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="9">
<pre><code>CLIENTNUM                   0.000
Attrition_Flag              0.000
Customer_Age                0.000
Gender                      0.000
Dependent_count             0.000
Education_Level            15.000
Marital_Status              7.400
Income_Category             0.000
Card_Category               0.000
Months_on_book              0.000
Total_Relationship_Count    0.000
Months_Inactive_12_mon      0.000
Contacts_Count_12_mon       0.000
Credit_Limit                0.000
Total_Revolving_Bal         0.000
Avg_Open_To_Buy             0.000
Total_Amt_Chng_Q4_Q1        0.000
Total_Trans_Amt             0.000
Total_Trans_Ct              0.000
Total_Ct_Chng_Q4_Q1         0.000
Avg_Utilization_Ratio       0.000
dtype: float64</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="c9c8f634" class="cell markdown" id="c9c8f634">
<ul>
<li>Education_Level has 15% missing values</li>
<li>Marital_Status has 7% missing values</li>
</ul>
</div>
<div id="bdfad989" class="cell code" id="bdfad989"
data-outputId="26b8791c-e13d-4534-c3f8-260666fb2b3b">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s view the statistical summary of the numerical columns in the data</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>data.describe().T</span></code></pre></div>
<div class="output execute_result" data-execution_count="10">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CLIENTNUM</th>
      <td>10127.000</td>
      <td>739177606.334</td>
      <td>36903783.450</td>
      <td>708082083.000</td>
      <td>713036770.500</td>
      <td>717926358.000</td>
      <td>773143533.000</td>
      <td>828343083.000</td>
    </tr>
    <tr>
      <th>Customer_Age</th>
      <td>10127.000</td>
      <td>46.326</td>
      <td>8.017</td>
      <td>26.000</td>
      <td>41.000</td>
      <td>46.000</td>
      <td>52.000</td>
      <td>73.000</td>
    </tr>
    <tr>
      <th>Dependent_count</th>
      <td>10127.000</td>
      <td>2.346</td>
      <td>1.299</td>
      <td>0.000</td>
      <td>1.000</td>
      <td>2.000</td>
      <td>3.000</td>
      <td>5.000</td>
    </tr>
    <tr>
      <th>Months_on_book</th>
      <td>10127.000</td>
      <td>35.928</td>
      <td>7.986</td>
      <td>13.000</td>
      <td>31.000</td>
      <td>36.000</td>
      <td>40.000</td>
      <td>56.000</td>
    </tr>
    <tr>
      <th>Total_Relationship_Count</th>
      <td>10127.000</td>
      <td>3.813</td>
      <td>1.554</td>
      <td>1.000</td>
      <td>3.000</td>
      <td>4.000</td>
      <td>5.000</td>
      <td>6.000</td>
    </tr>
    <tr>
      <th>Months_Inactive_12_mon</th>
      <td>10127.000</td>
      <td>2.341</td>
      <td>1.011</td>
      <td>0.000</td>
      <td>2.000</td>
      <td>2.000</td>
      <td>3.000</td>
      <td>6.000</td>
    </tr>
    <tr>
      <th>Contacts_Count_12_mon</th>
      <td>10127.000</td>
      <td>2.455</td>
      <td>1.106</td>
      <td>0.000</td>
      <td>2.000</td>
      <td>2.000</td>
      <td>3.000</td>
      <td>6.000</td>
    </tr>
    <tr>
      <th>Credit_Limit</th>
      <td>10127.000</td>
      <td>8631.954</td>
      <td>9088.777</td>
      <td>1438.300</td>
      <td>2555.000</td>
      <td>4549.000</td>
      <td>11067.500</td>
      <td>34516.000</td>
    </tr>
    <tr>
      <th>Total_Revolving_Bal</th>
      <td>10127.000</td>
      <td>1162.814</td>
      <td>814.987</td>
      <td>0.000</td>
      <td>359.000</td>
      <td>1276.000</td>
      <td>1784.000</td>
      <td>2517.000</td>
    </tr>
    <tr>
      <th>Avg_Open_To_Buy</th>
      <td>10127.000</td>
      <td>7469.140</td>
      <td>9090.685</td>
      <td>3.000</td>
      <td>1324.500</td>
      <td>3474.000</td>
      <td>9859.000</td>
      <td>34516.000</td>
    </tr>
    <tr>
      <th>Total_Amt_Chng_Q4_Q1</th>
      <td>10127.000</td>
      <td>0.760</td>
      <td>0.219</td>
      <td>0.000</td>
      <td>0.631</td>
      <td>0.736</td>
      <td>0.859</td>
      <td>3.397</td>
    </tr>
    <tr>
      <th>Total_Trans_Amt</th>
      <td>10127.000</td>
      <td>4404.086</td>
      <td>3397.129</td>
      <td>510.000</td>
      <td>2155.500</td>
      <td>3899.000</td>
      <td>4741.000</td>
      <td>18484.000</td>
    </tr>
    <tr>
      <th>Total_Trans_Ct</th>
      <td>10127.000</td>
      <td>64.859</td>
      <td>23.473</td>
      <td>10.000</td>
      <td>45.000</td>
      <td>67.000</td>
      <td>81.000</td>
      <td>139.000</td>
    </tr>
    <tr>
      <th>Total_Ct_Chng_Q4_Q1</th>
      <td>10127.000</td>
      <td>0.712</td>
      <td>0.238</td>
      <td>0.000</td>
      <td>0.582</td>
      <td>0.702</td>
      <td>0.818</td>
      <td>3.714</td>
    </tr>
    <tr>
      <th>Avg_Utilization_Ratio</th>
      <td>10127.000</td>
      <td>0.275</td>
      <td>0.276</td>
      <td>0.000</td>
      <td>0.023</td>
      <td>0.176</td>
      <td>0.503</td>
      <td>0.999</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="bf5e4a81" class="cell markdown" id="bf5e4a81">
<h4 id="observations">Observations:</h4>
<ul>
<li>CLIENTNUM: It is a unique identifier for customers and can be
dropped as it wouldn't add any information to our analysis.</li>
<li>Customer_Age: Average age of customers is 46 years, age of customers
has a wide range from 26 to 73 years.</li>
<li>Dependent_count: On average the customers in the data have 2
dependents and a maximum of 5 dependents.</li>
<li>Months_on_book: All the customers of the bank have at least been
with them for a year and 50% of the customers for at least 3 years.</li>
<li>Total_Relationship_Count: All customers use at least one product of
the bank, whereas 75% of customers use 5 or fewer products of the
bank.</li>
<li>Months_Inactive_12_mon: On average customers were inactive for two
months in the past 12 months - this shows that the bank customers are
active in transactions or usage of cards it would be interesting to see
if high inactivity leads to churning of a customer.</li>
<li>Contacts_Count_12_mon: On average bank and customers interacted
twice in the past 12 months.</li>
<li>Credit_Limit: There's a huge difference between the third quartile
and maximum value. The range of credit limit is very wide from 1438 to
34516, customers with high credit limit might be outliers.</li>
<li>Total_Revolving_Bal: Average revolving balance of customers is 1162,
there's not much difference in the third quartile and maximum
value.</li>
<li>Avg_Open_To_Buy: Average amount that goes unused by the customers is
7469, the range is very wide for this variable and the extreme
values(min and max) might be outliers.</li>
<li>Total_Amt_Chng_Q4_Q1: For 75% of the customers the transaction
amount in Q4 was less than the transaction amount in Q1 (as value is
equal to ~0.9).</li>
<li>Total_Trans_Amt: Average transaction amount of last 12 months is
4404, some customers spent as little as 510 while some customers made
the transaction of more than 18k.</li>
<li>Total_Trans_Ct: On average customers made 64 or fewer transactions
while 75% of the customers made 81 transactions.</li>
<li>Total_Ct_Chng_Q4_Q1: For 75% of the customers the number of
transactions in Q4 was less than the transactions made in Q1.</li>
<li>Avg_Utilization_Ratio: On average customers used ~27% of the
available credit amount of their card, with 75% of the customers
utilizing 50% or less of their available credit amount.</li>
</ul>
</div>
<div id="7b047856" class="cell code" id="7b047856"
data-outputId="5e98f7db-f69d-4047-bed2-78e181f9899c">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data.describe(include<span class="op">=</span>[<span class="st">&quot;object&quot;</span>]).T</span></code></pre></div>
<div class="output execute_result" data-execution_count="11">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Attrition_Flag</th>
      <td>10127</td>
      <td>2</td>
      <td>Existing Customer</td>
      <td>8500</td>
    </tr>
    <tr>
      <th>Gender</th>
      <td>10127</td>
      <td>2</td>
      <td>F</td>
      <td>5358</td>
    </tr>
    <tr>
      <th>Education_Level</th>
      <td>8608</td>
      <td>6</td>
      <td>Graduate</td>
      <td>3128</td>
    </tr>
    <tr>
      <th>Marital_Status</th>
      <td>9378</td>
      <td>3</td>
      <td>Married</td>
      <td>4687</td>
    </tr>
    <tr>
      <th>Income_Category</th>
      <td>10127</td>
      <td>6</td>
      <td>Less than $40K</td>
      <td>3561</td>
    </tr>
    <tr>
      <th>Card_Category</th>
      <td>10127</td>
      <td>4</td>
      <td>Blue</td>
      <td>9436</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="2c87adfc" class="cell code" id="2c87adfc"
data-outputId="f6b4d94e-6995-463a-c320-dfe7587a76e1">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> data.describe(include<span class="op">=</span>[<span class="st">&quot;object&quot;</span>]).columns:</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Unique values in&quot;</span>, i, <span class="st">&quot;are :&quot;</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(data[i].value_counts())</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;*&quot;</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Unique values in Attrition_Flag are :
Existing Customer    8500
Attrited Customer    1627
Name: Attrition_Flag, dtype: int64
**************************************************
Unique values in Gender are :
F    5358
M    4769
Name: Gender, dtype: int64
**************************************************
Unique values in Education_Level are :
Graduate         3128
High School      2013
Uneducated       1487
College          1013
Post-Graduate     516
Doctorate         451
Name: Education_Level, dtype: int64
**************************************************
Unique values in Marital_Status are :
Married     4687
Single      3943
Divorced     748
Name: Marital_Status, dtype: int64
**************************************************
Unique values in Income_Category are :
Less than $40K    3561
$40K - $60K       1790
$80K - $120K      1535
$60K - $80K       1402
abc               1112
$120K +            727
Name: Income_Category, dtype: int64
**************************************************
Unique values in Card_Category are :
Blue        9436
Silver       555
Gold         116
Platinum      20
Name: Card_Category, dtype: int64
**************************************************
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="a35eb216" class="cell markdown" id="a35eb216">
<p><strong>Observations</strong></p>
<ul>
<li>Most of the records are for existing customers.</li>
<li>Most of the bank's customers are female</li>
<li>Most customers are graduates.</li>
<li>Most customers are married.</li>
<li>Most customers lie in the income group of less than $40k</li>
<li>Most customers have a blue card.</li>
<li>The data is imbalanced</li>
</ul>
<p><strong>Missing values</strong></p>
<ul>
<li>'abc' value of Income_Category can be considered and treated as
missing values.</li>
</ul>
</div>
<div id="3efde1c3" class="cell markdown" id="3efde1c3">
<h2 id="data-pre-processing">Data Pre-processing</h2>
</div>
<div id="fc5c4135" class="cell code" id="fc5c4135"
data-outputId="f0b6fdfc-0618-4446-ca3a-7edf7c790ba8">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CLIENTNUM consists of uniques ID for clients and hence will not add value to the modeling</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>data.drop([<span class="st">&quot;CLIENTNUM&quot;</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="d06a79d8" class="cell code" id="d06a79d8"
data-outputId="82fede90-c26c-449b-999d-9da91ab8506a">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Encoding Existing and Attrited customers to 0 and 1 respectively, for analysis.</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&quot;Attrition_Flag&quot;</span>].replace(<span class="st">&quot;Existing Customer&quot;</span>, <span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&quot;Attrition_Flag&quot;</span>].replace(<span class="st">&quot;Attrited Customer&quot;</span>, <span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="cd98a714" class="cell markdown" id="cd98a714">
<p><a id='eda'></a></p>
<h3 id="summary-of-eda"><a id='link'>Summary of EDA</a></h3>
<ul>
<li>The dataset has 10127 rows and 21 columns.</li>
<li>There are null values in the Education_Level and Marital_Status</li>
<li>5 columns are of object type rest all are numerical.</li>
</ul>
<p><strong>Data Cleaning</strong></p>
<ul>
<li>CLIENTNUM column consists of uniques ID for clients and hence will
not add value to the modeling. This column has been dropped.</li>
<li>The target varaible is encoded to numeric.</li>
<li>Missing value imputation will be done after splitting the data.</li>
</ul>
<p><strong>Univariate Analysis</strong></p>
</div>
<div id="e000d424" class="cell code" id="e000d424"
data-outputId="5b5cb70f-5e0e-46ca-b10a-10168490de2f">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating histograms</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>data.hist(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">14</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/d168799b8ebd87eaca4124297df13625752c4b03.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="6f62a4b1" class="cell markdown" id="6f62a4b1">
<ul>
<li><code>Customer_Age</code> : The distribution of Customer_Age is
normally distributed with mean and median at 46 years.</li>
<li><code>Dependent_count</code> : Most customers are having 2 or 3
dependents.</li>
<li><code>Months_on_book</code> : Most customers are with the bank for 3
years.</li>
<li><code>Total_Relationship_Count</code> : Equal percentage of
customers using 4,5 and 6 products might suggest that customers who opt
or buy the 4th product will also be ready to buy more products.</li>
<li><code>Months_Inactive_12_mon</code> : Very few customers were
inactive for more than 3 months.</li>
<li><code>Contacts_Count_12_mon</code> : Most of the customers
interacted with the bank less than 4 times in the past 12 months.</li>
<li><code>Credit_Limit</code> : The distribution of the Credit_Limit is
skewed to the right. There are quite a few customers with a maximum
Credit Limit of 35000. 50% of the customers of the bank have a credit
limit of less than &lt;5000.</li>
<li><code>Total_Revolving_Bal</code> : Most customers pay the complete
dues of credit card and have 0 revolving balance.</li>
<li><code>Avg_Open_To_Buy</code> : The distribution of the
Avg_Open_To_Buy column is right-skewed. A right-skewed distribution
indicates that most customers used a big part of their limit while only
a few customers (on the right tail) were left with a majority of their
credit amount.</li>
<li><code>Total_Amt_Chng_Q4_Q1</code> : The distribution of
Total_Amt_Chng_Q4_Q1 looks normally distributed but there's a slight
skew towards the right.</li>
<li><code>Total_Trans_Amt</code> : The distribution of Total_Trans_Amt
is skewed to the right. There are two peaks in data at total transaction
amounts of one around 2500 and the second around the mean value of
~4500.</li>
<li><code>Total_Trans_Ct</code> : The distribution of Total_Trans_Ct
shows two peaks on 40 and 80 transactions in a year which indicates that
customers used credit cards 3 to 6 times a month to make
transactions.</li>
<li><code>Total_Ct_Chng_Q4_Q1</code> : The distribution of
Total_Ct_Chng_Q4_Q1 looks normally distributed but there's a slight skew
towards the right.</li>
<li><code>Avg_Utilization_Ratio</code> : The distribution of
Avg_Utilization_Ratio is skewed to the right. This distribution is not a
positive sign for the bank as most of the customers are not utilizing
their credit amount.</li>
</ul>
<p>Catergorical variables:</p>
<ul>
<li><code>Gender</code> : We have an almost equal percentage of Male and
Female customers.</li>
<li><code>Education_Level</code> : 30.9% of the customers are graduates,
followed by 19.9% of the customers who completed high school. Percentage
of missing value in Education_Level column - 15%.</li>
<li><code>Marital_Status</code> : 46.3% of the customers are Married,
followed by 38.9% of Single customers. Percentage of missing value in
Marital_Status column - 7.4%.</li>
<li><code>Income_Category</code> : 35.2% of the customers lie in the
Less than 40k income category group, followed by 17.7% of the customers
in the 40k-60k income group. Percentage of missing value in
Income_Category column - 11%.</li>
<li><code>Card_Category</code> : 93.2% of the customers have the Blue
card. Blue card would be a standard card given by the bank to all its
customers.</li>
</ul>
<p><strong>Bivariate Analysis</strong></p>
<ul>
<li>Attrition_Flag shows a bit of a negative correlation with
Total_Trans_Ct (total transactions) and Total_Trans_Amt (total
transaction amount).</li>
<li>There's a strong positive correlation between Months_on_book and
Customer_Age, Total_Revolving_Bal and Avg_Utilization_Ratio,
Total_Trans_Amt and Total_Trans_Ct.</li>
<li>There's a negative correlation of Total_Relationship_count with
Total_Trans_Amt and Total_Trans_Ct, Avg_Utilization_Ratio with
Credit_Limit and Avg_Open_To_Buy.</li>
</ul>
<p><strong>Attrition_Flag vs Gender</strong>:</p>
<ul>
<li>There's not much difference in attrition percentages for Males and
Females.</li>
<li>~20% of both Males and Females attrite.</li>
</ul>
<p><strong>Attrition_Flag vs Marital_Status</strong>:</p>
<ul>
<li>There's not much difference in attrition percentages for
Marital_Status.</li>
<li>~20% of Singles, Divorced attrite.</li>
<li>Married customers attrite the least.</li>
</ul>
<p><strong>Attrition_Flag vs Education_Level</strong>:</p>
<ul>
<li>Customers with higher education - Doctorates and Post Graduates are
the ones most(~20% for both education levels) attriting.</li>
</ul>
<p><strong>Attrition_Flag vs Income_Category</strong>:</p>
<ul>
<li>The customers from two extreme income groups - Earning less than 40K
and Earning more than 120k+ are the ones attriting the most.</li>
</ul>
<p><strong>Attrition_Flag vs Card_Category</strong>:</p>
<ul>
<li>~35% of attrition is amongst the customers with platinum cards
followed by ~30% attrition in Gold cards.</li>
<li>Customers with Platinum and Gold cards are our premium customers and
the highest attrition for these customers is alarming as they are using
the premium card provided by the bank.</li>
</ul>
<p><strong>Attrition_Flag vs Contacts_Count_12_mon</strong>:</p>
<ul>
<li>Highest attrition is among the customers who interacted the most
with the bank.</li>
<li>This signifies that the bank is not able to resolve the problems
faced by customers leading to attrition</li>
<li>A preliminary step to identify attriting customers would be to look
out for customers who have reached out to them repeatedly.</li>
</ul>
<p><strong>Attrition_Flag vs Months_Inactive_12_mon</strong>:</p>
<ul>
<li>As inactivity increases attrition also increases (2-4 months)</li>
<li>The interpretation from here for 0 months and 6 months is difficult
as customers who recently used the card attrited the most while those
who were inactive for 6 months attrited less.</li>
</ul>
<p><strong>Attrition_Flag vs Total_Relationship_Count</strong>:</p>
<ul>
<li>Attrition is highest among the customers who are using 1 or 2
products offered by the bank - together they constitute ~55% of the
attrition.</li>
<li>Customers who use more than 3 products are the ones least attriting,
such customers might be more financially stable and actively invest in
different services provided by the bank.</li>
</ul>
<p><strong>Attrition_Flag vs Dependent_count</strong>:</p>
<ul>
<li>More the number of dependents more is the attrition, more
responsibilities might lead to financial instability in such
customers.</li>
<li>Attrition is fairly low for customers with 0 or 1 dependents.</li>
</ul>
<p><strong>Attrition_Flag vs Credit_Limit</strong>:</p>
<ul>
<li>Customers with lower credit limits are the ones who attrited.</li>
</ul>
<p><strong>Attrition_Flag vs Total_Revolving_Bal</strong>:</p>
</div>
<div id="d349fbf9" class="cell code" id="d349fbf9"
data-outputId="6f8d87dd-fb51-4330-fca2-5d48d16416a7">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Revolving_Bal&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/f34ec07f5acce3e6435cf34f871e2f49a4a1de7d.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="d9fa126c" class="cell markdown" id="d9fa126c">
<ul>
<li>Customers with less total revolving balance are the ones who
attrited, such customers must have cleared their dues and opted out of
the credit card service.</li>
</ul>
<p><strong>Attrition_Flag vs Avg_Open_To_Buy</strong>:</p>
<ul>
<li>There's not much difference in the distribution for an attrited and
existing customer.</li>
</ul>
<p><strong>Attrition_Flag vs Total_Trans_Ct</strong>:</p>
</div>
<div id="e34b2b16" class="cell code" id="e34b2b16"
data-outputId="f7e819dd-ce7d-40f8-f0bb-f76388865768">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Trans_Ct&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/d8243cba0a9260340ffcf2103ec9b7450f0934af.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="f785cd79" class="cell markdown" id="f785cd79">
<ul>
<li>Less number of transactions lead to higher attrition.</li>
<li>Customers with less than 80 to 100 transactions (or median
transactions equal to 40) in a year should be more focused upon.</li>
</ul>
<p><strong>Attrition_Flag vs Total_Trans_Amt</strong>:</p>
</div>
<div id="7d7e711c" class="cell code" id="7d7e711c"
data-outputId="b99f018e-5b69-407d-d43a-c0087c7b399f">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Trans_Amt&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/e30e0aec9b6480f3aabd7e76c1779d3619fefb4c.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="5c3d6a52" class="cell markdown" id="5c3d6a52">
<ul>
<li>Less number of transactions might lead to a less transaction amount
and eventually leading to customer attrition.</li>
</ul>
<p><strong>Attrition_Flag vs Total_Amt_Chng_Q4_Q1</strong>:</p>
<ul>
<li>Customers who didn't attrite showed less variability across Q4 to Q1
as compared to the ones who attrited.</li>
</ul>
<p><strong>Attrition_Flag vs Total_Ct_Chng_Q4_Q1</strong>:</p>
</div>
<div id="c99ed6bf" class="cell code" id="c99ed6bf"
data-outputId="ac7147cf-98a9-42db-f6a3-a1ee2a6139c7">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Ct_Chng_Q4_Q1&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/15747953bbc77d2a26c4dd6aa435cdaab73c8f31.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="d9f0a026" class="cell markdown" id="d9f0a026">
<ul>
<li>Customers who didn't attrite showed less variability across Q4 to Q1
as compared to the ones who attrited.</li>
</ul>
<p><strong>Attrition_Flag vs Avg_Utilization_Ratio</strong>:</p>
</div>
<div id="2e9d6fe5" class="cell code" id="2e9d6fe5"
data-outputId="cad98bdd-a562-45e1-8647-5c33e4057909">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Avg_Utilization_Ratio&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/572d1e3cbdeb86aafc801820a0274b7abe6e1b67.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="a8a501c7" class="cell markdown" id="a8a501c7">
<ul>
<li>Customers utilizing their full credit limit are the ones who didn't
attrite.</li>
<li>Less utilization of the available credits indicates inactivity of
customers.</li>
</ul>
</div>
<div id="e7c3981e" class="cell markdown" id="e7c3981e">
<h3
id="lets-find-the-percentage-of-outliers-in-each-column-of-the-data-using-iqr">Let's
find the percentage of outliers, in each column of the data, using
IQR.</h3>
</div>
<div id="617e8bd0" class="cell code" id="617e8bd0"
data-outputId="c20dc206-7cde-4be3-e985-3d10e48daa1b">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Q1 <span class="op">=</span> data.quantile(<span class="fl">0.25</span>)  <span class="co"># To find the 25th percentile and 75th percentile.</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>Q3 <span class="op">=</span> data.quantile(<span class="fl">0.75</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1  <span class="co"># Inter Quantile Range (75th perentile - 25th percentile)</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>lower <span class="op">=</span> (</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    Q1 <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>)  <span class="co"># Finding lower and upper bounds for all values. All values outside these bounds are outliers</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> Q3 <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="dc9689d8" class="cell code" id="dc9689d8"
data-outputId="4ebd4859-16db-4c9b-9171-08420299cbfd">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    (data.select_dtypes(include<span class="op">=</span>[<span class="st">&quot;float64&quot;</span>, <span class="st">&quot;int64&quot;</span>]) <span class="op">&lt;</span> lower)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> (data.select_dtypes(include<span class="op">=</span>[<span class="st">&quot;float64&quot;</span>, <span class="st">&quot;int64&quot;</span>]) <span class="op">&gt;</span> upper)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>).<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(data) <span class="op">*</span> <span class="dv">100</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="26">
<pre><code>Attrition_Flag             16.066
Customer_Age                0.020
Dependent_count             0.000
Months_on_book              3.812
Total_Relationship_Count    0.000
Months_Inactive_12_mon      3.268
Contacts_Count_12_mon       6.211
Credit_Limit                9.717
Total_Revolving_Bal         0.000
Avg_Open_To_Buy             9.509
Total_Amt_Chng_Q4_Q1        3.910
Total_Trans_Amt             8.848
Total_Trans_Ct              0.020
Total_Ct_Chng_Q4_Q1         3.891
Avg_Utilization_Ratio       0.000
dtype: float64</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="52cd62d7" class="cell markdown" id="52cd62d7">
<ul>
<li>After identifying outliers, we can decide whether to remove/treat
them or not. It depends on one's approach, here we are not going to
treat them as there will be outliers in real case scenario (in age, the
total amount of transactions, number of transactions, etc) and we would
want our model to learn the underlying pattern for such customers.</li>
</ul>
</div>
<div id="081ec1f8" class="cell markdown" id="081ec1f8">
<h3 id="missing-value-imputation">Missing value imputation</h3>
<ul>
<li>We will first replace 'abc' values with 'np.nan' in
Income_Category</li>
<li>We will impute missing values in all 3 columns using mode</li>
</ul>
</div>
<div id="70b8307d" class="cell code" id="70b8307d"
data-outputId="b28a2277-1338-4aa9-f123-6eaa39c8684e">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data1 <span class="op">=</span> data.copy()</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e25f10b0" class="cell code" id="e25f10b0"
data-outputId="c698eec7-97df-4d10-8cfc-ea033715ddc3">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>data1[<span class="st">&quot;Income_Category&quot;</span>].replace(<span class="st">&quot;abc&quot;</span>, np.nan, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="8a9274c8" class="cell code" id="8a9274c8"
data-outputId="d08c5140-7412-465a-b301-a3c9b3999428">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>data1.isna().<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="29">
<pre><code>Attrition_Flag                 0
Customer_Age                   0
Gender                         0
Dependent_count                0
Education_Level             1519
Marital_Status               749
Income_Category             1112
Card_Category                  0
Months_on_book                 0
Total_Relationship_Count       0
Months_Inactive_12_mon         0
Contacts_Count_12_mon          0
Credit_Limit                   0
Total_Revolving_Bal            0
Avg_Open_To_Buy                0
Total_Amt_Chng_Q4_Q1           0
Total_Trans_Amt                0
Total_Trans_Ct                 0
Total_Ct_Chng_Q4_Q1            0
Avg_Utilization_Ratio          0
dtype: int64</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="b0c1753e" class="cell markdown" id="b0c1753e">
<ul>
<li>Values have been replaced.</li>
</ul>
</div>
<div id="93e65425" class="cell code" id="93e65425"
data-outputId="5bbc0102-6216-4b0f-a4e9-8eb29e4ea5e4">
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="st">&quot;most_frequent&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="f54a957a" class="cell code" id="f54a957a"
data-outputId="15f2efd7-8796-486c-ac12-12c5aee89cd7">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data1.drop([<span class="st">&quot;Attrition_Flag&quot;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data1[<span class="st">&quot;Attrition_Flag&quot;</span>]</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="72d57cb2" class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:34}"
id="72d57cb2" data-outputId="c05575bb-cda5-4b49-d6dd-3f6c8cb0678e">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting data into training, validation and test set:</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># first we split data into 2 parts, say temporary and test</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>X_temp, X_test, y_temp, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1</span>, stratify<span class="op">=</span>y</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># then we split the temporary set into train and validation</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    X_temp, y_temp, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">1</span>, stratify<span class="op">=</span>y_temp</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape, X_val.shape, X_test.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(6075, 19) (2026, 19) (2026, 19)
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="1eedeab5" class="cell code" id="1eedeab5"
data-outputId="f3a33632-e977-4731-e347-23b514b4ff23">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>reqd_col_for_impute <span class="op">=</span> [<span class="st">&quot;Education_Level&quot;</span>, <span class="st">&quot;Marital_Status&quot;</span>, <span class="st">&quot;Income_Category&quot;</span>]</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="6a9ea1cb" class="cell code" id="6a9ea1cb"
data-outputId="3c715247-3b68-46bf-ada9-799be7c5327f">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform the train data</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>X_train[reqd_col_for_impute] <span class="op">=</span> imputer.fit_transform(X_train[reqd_col_for_impute])</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the validation data</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>X_val[reqd_col_for_impute] <span class="op">=</span> imputer.transform(X_val[reqd_col_for_impute])</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the test data</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>X_test[reqd_col_for_impute] <span class="op">=</span> imputer.transform(X_test[reqd_col_for_impute])</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="c86c92e4" class="cell code" id="c86c92e4"
data-outputId="11a6e7ae-8a9e-4946-b0b0-0a2d6c32f971">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking that no column has missing values in train or test sets</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.isna().<span class="bu">sum</span>())</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val.isna().<span class="bu">sum</span>())</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_test.isna().<span class="bu">sum</span>())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Customer_Age                0
Gender                      0
Dependent_count             0
Education_Level             0
Marital_Status              0
Income_Category             0
Card_Category               0
Months_on_book              0
Total_Relationship_Count    0
Months_Inactive_12_mon      0
Contacts_Count_12_mon       0
Credit_Limit                0
Total_Revolving_Bal         0
Avg_Open_To_Buy             0
Total_Amt_Chng_Q4_Q1        0
Total_Trans_Amt             0
Total_Trans_Ct              0
Total_Ct_Chng_Q4_Q1         0
Avg_Utilization_Ratio       0
dtype: int64
------------------------------
Customer_Age                0
Gender                      0
Dependent_count             0
Education_Level             0
Marital_Status              0
Income_Category             0
Card_Category               0
Months_on_book              0
Total_Relationship_Count    0
Months_Inactive_12_mon      0
Contacts_Count_12_mon       0
Credit_Limit                0
Total_Revolving_Bal         0
Avg_Open_To_Buy             0
Total_Amt_Chng_Q4_Q1        0
Total_Trans_Amt             0
Total_Trans_Ct              0
Total_Ct_Chng_Q4_Q1         0
Avg_Utilization_Ratio       0
dtype: int64
------------------------------
Customer_Age                0
Gender                      0
Dependent_count             0
Education_Level             0
Marital_Status              0
Income_Category             0
Card_Category               0
Months_on_book              0
Total_Relationship_Count    0
Months_Inactive_12_mon      0
Contacts_Count_12_mon       0
Credit_Limit                0
Total_Revolving_Bal         0
Avg_Open_To_Buy             0
Total_Amt_Chng_Q4_Q1        0
Total_Trans_Amt             0
Total_Trans_Ct              0
Total_Ct_Chng_Q4_Q1         0
Avg_Utilization_Ratio       0
dtype: int64
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="2ef3affd" class="cell markdown" id="2ef3affd">
<ul>
<li>All missing values have been treated.</li>
</ul>
</div>
<div id="29d06e61" class="cell code" id="29d06e61"
data-outputId="8220addd-60fc-402f-f806-ba715054c3dc">
<div class="sourceCode" id="cb73"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">&quot;object&quot;</span>, <span class="st">&quot;category&quot;</span>])</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> cols.columns:</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(X_train[i].value_counts())</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;*&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>F    3193
M    2882
Name: Gender, dtype: int64
******************************
Graduate         2782
High School      1228
Uneducated        881
College           618
Post-Graduate     312
Doctorate         254
Name: Education_Level, dtype: int64
******************************
Married     3276
Single      2369
Divorced     430
Name: Marital_Status, dtype: int64
******************************
Less than $40K    2783
$40K - $60K       1059
$80K - $120K       953
$60K - $80K        831
$120K +            449
Name: Income_Category, dtype: int64
******************************
Blue        5655
Silver       339
Gold          69
Platinum      12
Name: Card_Category, dtype: int64
******************************
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="136c6022" class="cell code" id="136c6022"
data-outputId="ddd6f725-a5c1-4bbc-dc11-441dbe019745">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> X_val.select_dtypes(include<span class="op">=</span>[<span class="st">&quot;object&quot;</span>, <span class="st">&quot;category&quot;</span>])</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> cols.columns:</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(X_val[i].value_counts())</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;*&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>F    1095
M     931
Name: Gender, dtype: int64
******************************
Graduate         917
High School      404
Uneducated       306
College          199
Post-Graduate    101
Doctorate         99
Name: Education_Level, dtype: int64
******************************
Married     1100
Single       770
Divorced     156
Name: Marital_Status, dtype: int64
******************************
Less than $40K    957
$40K - $60K       361
$80K - $120K      293
$60K - $80K       279
$120K +           136
Name: Income_Category, dtype: int64
******************************
Blue        1905
Silver        97
Gold          21
Platinum       3
Name: Card_Category, dtype: int64
******************************
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="09ce8c1f" class="cell code" id="09ce8c1f"
data-outputId="732cce3a-adb4-40c6-a6de-8c442a582196">
<div class="sourceCode" id="cb79"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> X_test.select_dtypes(include<span class="op">=</span>[<span class="st">&quot;object&quot;</span>, <span class="st">&quot;category&quot;</span>])</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> cols.columns:</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(X_train[i].value_counts())</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;*&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>F    3193
M    2882
Name: Gender, dtype: int64
******************************
Graduate         2782
High School      1228
Uneducated        881
College           618
Post-Graduate     312
Doctorate         254
Name: Education_Level, dtype: int64
******************************
Married     3276
Single      2369
Divorced     430
Name: Marital_Status, dtype: int64
******************************
Less than $40K    2783
$40K - $60K       1059
$80K - $120K       953
$60K - $80K        831
$120K +            449
Name: Income_Category, dtype: int64
******************************
Blue        5655
Silver       339
Gold          69
Platinum      12
Name: Card_Category, dtype: int64
******************************
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="1db1b914" class="cell markdown" id="1db1b914">
<h3 id="encoding-categorical-variables">Encoding categorical
variables</h3>
</div>
<div id="bc60ffe4" class="cell code" id="bc60ffe4"
data-outputId="1ad60198-6f08-41e5-ccdf-0441d825ebc4">
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> pd.get_dummies(X_train, drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> pd.get_dummies(X_val, drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> pd.get_dummies(X_test, drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape, X_val.shape, X_test.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(6075, 29) (2026, 29) (2026, 29)
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="b2c34f29" class="cell markdown" id="b2c34f29">
<ul>
<li>After encoding there are 29 columns.</li>
</ul>
</div>
<div id="5e41bd76" class="cell code" id="5e41bd76"
data-outputId="56a020bc-f958-4b2d-e4d5-68a8bf2a1586">
<div class="sourceCode" id="cb85"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>X_train.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="40">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Customer_Age</th>
      <th>Dependent_count</th>
      <th>Months_on_book</th>
      <th>Total_Relationship_Count</th>
      <th>Months_Inactive_12_mon</th>
      <th>Contacts_Count_12_mon</th>
      <th>Credit_Limit</th>
      <th>Total_Revolving_Bal</th>
      <th>Avg_Open_To_Buy</th>
      <th>Total_Amt_Chng_Q4_Q1</th>
      <th>Total_Trans_Amt</th>
      <th>Total_Trans_Ct</th>
      <th>Total_Ct_Chng_Q4_Q1</th>
      <th>Avg_Utilization_Ratio</th>
      <th>Gender_M</th>
      <th>Education_Level_Doctorate</th>
      <th>Education_Level_Graduate</th>
      <th>Education_Level_High School</th>
      <th>Education_Level_Post-Graduate</th>
      <th>Education_Level_Uneducated</th>
      <th>Marital_Status_Married</th>
      <th>Marital_Status_Single</th>
      <th>Income_Category_$40K - $60K</th>
      <th>Income_Category_$60K - $80K</th>
      <th>Income_Category_$80K - $120K</th>
      <th>Income_Category_Less than $40K</th>
      <th>Card_Category_Gold</th>
      <th>Card_Category_Platinum</th>
      <th>Card_Category_Silver</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>800</th>
      <td>40</td>
      <td>2</td>
      <td>21</td>
      <td>6</td>
      <td>4</td>
      <td>3</td>
      <td>20056.000</td>
      <td>1602</td>
      <td>18454.000</td>
      <td>0.466</td>
      <td>1687</td>
      <td>46</td>
      <td>0.533</td>
      <td>0.080</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>498</th>
      <td>44</td>
      <td>1</td>
      <td>34</td>
      <td>6</td>
      <td>2</td>
      <td>0</td>
      <td>2885.000</td>
      <td>1895</td>
      <td>990.000</td>
      <td>0.387</td>
      <td>1366</td>
      <td>31</td>
      <td>0.632</td>
      <td>0.657</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4356</th>
      <td>48</td>
      <td>4</td>
      <td>36</td>
      <td>5</td>
      <td>1</td>
      <td>2</td>
      <td>6798.000</td>
      <td>2517</td>
      <td>4281.000</td>
      <td>0.873</td>
      <td>4327</td>
      <td>79</td>
      <td>0.881</td>
      <td>0.370</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>407</th>
      <td>41</td>
      <td>2</td>
      <td>36</td>
      <td>6</td>
      <td>2</td>
      <td>0</td>
      <td>27000.000</td>
      <td>0</td>
      <td>27000.000</td>
      <td>0.610</td>
      <td>1209</td>
      <td>39</td>
      <td>0.300</td>
      <td>0.000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8728</th>
      <td>46</td>
      <td>4</td>
      <td>36</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>15034.000</td>
      <td>1356</td>
      <td>13678.000</td>
      <td>0.754</td>
      <td>7737</td>
      <td>84</td>
      <td>0.750</td>
      <td>0.090</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="0a61f9de" class="cell markdown" id="0a61f9de">
<h2 id="building-the-model">Building the model</h2>
</div>
<div id="59e7f611" class="cell markdown" id="59e7f611">
<h2 id="model-evaluation-criterion">Model evaluation criterion</h2>
<h3 id="model-can-make-wrong-predictions-as">Model can make wrong
predictions as:</h3>
<ol>
<li>Predicting a customer will attrite and the customer doesn't
attrite</li>
<li>Predicting a customer will not attrite and the customer
attrites</li>
</ol>
<h3 id="which-case-is-more-important">Which case is more important?</h3>
<ul>
<li>Predicting that customer will not attrite but he attrites i.e.
losing on a valuable customer or asset.</li>
</ul>
<h3 id="how-to-reduce-this-loss-ie-need-to-reduce-false-negatives">How
to reduce this loss i.e need to reduce False Negatives?</h3>
<ul>
<li>Bank would want <code>Recall</code> to be maximized, greater the
Recall higher the chances of minimizing false negatives. Hence, the
focus should be on increasing Recall or minimizing the false negatives
or in other words identifying the true positives(i.e. Class 1) so that
the bank can retain their valuable customers by identifying the
customers who are at risk of attrition.</li>
</ul>
</div>
<div id="2c7c46e1" class="cell markdown" id="2c7c46e1">
<p><strong>Fist, let's create two functions to calculate different
metrics and confusion matrix, so that we don't have to use the same code
repeatedly for each model.</strong></p>
</div>
<div id="28675acc" class="cell code" id="28675acc"
data-outputId="5be6c7d9-8347-4679-fb3d-37b60ca98fc8">
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># defining a function to compute different metrics to check performance of a classification model built using sklearn</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_performance_classification_sklearn(model, predictors, target):</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Function to compute different metrics to check classification model performance</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co">    model: classifier</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">    predictors: independent variables</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co">    target: dependent variable</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predicting using the independent variables</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> model.predict(predictors)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> accuracy_score(target, pred)  <span class="co"># to compute Accuracy</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    recall <span class="op">=</span> recall_score(target, pred)  <span class="co"># to compute Recall</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    precision <span class="op">=</span> precision_score(target, pred)  <span class="co"># to compute Precision</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> f1_score(target, pred)  <span class="co"># to compute F1-score</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># creating a dataframe of metrics</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    df_perf <span class="op">=</span> pd.DataFrame(</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;Accuracy&quot;</span>: acc, <span class="st">&quot;Recall&quot;</span>: recall, <span class="st">&quot;Precision&quot;</span>: precision, <span class="st">&quot;F1&quot;</span>: f1,},</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_perf</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="8d3adba0" class="cell code" id="8d3adba0"
data-outputId="cfe08a07-63d1-4dfe-ec14-9a82f23db51d">
<div class="sourceCode" id="cb89"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> confusion_matrix_sklearn(model, predictors, target):</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co">    To plot the confusion_matrix with percentages</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co">    model: classifier</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co">    predictors: independent variables</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co">    target: dependent variable</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(predictors)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(target, y_pred)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> np.asarray(</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>            [<span class="st">&quot;</span><span class="sc">{0:0.0f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(item) <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="sc">{0:.2%}</span><span class="st">&quot;</span>.<span class="bu">format</span>(item <span class="op">/</span> cm.flatten().<span class="bu">sum</span>())]</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> cm.flatten()</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    ).reshape(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(cm, annot<span class="op">=</span>labels, fmt<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&quot;True label&quot;</span>)</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Predicted label&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="cdea3372" class="cell markdown" id="cdea3372">
<h2 id="model-with-original-data">Model with original data</h2>
</div>
<div id="be50c6d3" class="cell code" id="be50c6d3"
data-outputId="4e709f0c-afdd-4487-e066-318f0c23c4d6">
<div class="sourceCode" id="cb91"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> []  <span class="co"># Empty list to store all the models</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Appending models into the list</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Logistic regression&quot;</span>, LogisticRegression(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Bagging&quot;</span>, BaggingClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Random forest&quot;</span>, RandomForestClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;GBM&quot;</span>, GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Adaboost&quot;</span>, AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Xgboost&quot;</span>, XGBClassifier(random_state<span class="op">=</span><span class="dv">1</span>, eval_metric<span class="op">=</span><span class="st">&quot;logloss&quot;</span>)))</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;dtree&quot;</span>, DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="st">&quot;Training Performance:&quot;</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models:</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> recall_score(y_train, model.predict(X_train))</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(name, scores))</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="st">&quot;Validation Performance:&quot;</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models:</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>    scores_val <span class="op">=</span> recall_score(y_val, model.predict(X_val))</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(name, scores_val))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
Training Performance:

Logistic regression: 0.4354508196721312
Bagging: 0.985655737704918
Random forest: 1.0
GBM: 0.875
Adaboost: 0.826844262295082
Xgboost: 1.0
dtree: 1.0

Validation Performance:

Logistic regression: 0.4723926380368098
Bagging: 0.8128834355828221
Random forest: 0.7975460122699386
GBM: 0.8558282208588958
Adaboost: 0.852760736196319
Xgboost: 0.8834355828220859
dtree: 0.8159509202453987
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="7f36a907" class="cell markdown" id="7f36a907">
<h3 id="performance-comparison">Performance comparison</h3>
<ul>
<li>Xgboost has the best performance on the validation followed by GBM
and Adaboost</li>
</ul>
</div>
<div id="d6cf8a19" class="cell markdown" id="d6cf8a19">
<h2 id="models-with-oversampled-data">Models with Oversampled data</h2>
</div>
<div id="6b25ae18" class="cell code" id="6b25ae18"
data-outputId="080769a6-8369-4698-ff38-1b38729c35a7">
<div class="sourceCode" id="cb94"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Before Oversampling, counts of label &#39;Yes&#39;: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">sum</span>(y_train <span class="op">==</span> <span class="dv">1</span>)))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Before Oversampling, counts of label &#39;No&#39;: </span><span class="sc">{}</span><span class="st"> </span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">sum</span>(y_train <span class="op">==</span> <span class="dv">0</span>)))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> SMOTE(</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="dv">1</span>, k_neighbors<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">1</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>)  <span class="co"># Synthetic Minority Over Sampling Technique</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>X_train_over, y_train_over <span class="op">=</span> sm.fit_resample(X_train, y_train)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;After Oversampling, counts of label &#39;Yes&#39;: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">sum</span>(y_train_over <span class="op">==</span> <span class="dv">1</span>)))</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;After Oversampling, counts of label &#39;No&#39;: </span><span class="sc">{}</span><span class="st"> </span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">sum</span>(y_train_over <span class="op">==</span> <span class="dv">0</span>)))</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;After Oversampling, the shape of train_X: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(X_train_over.shape))</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;After Oversampling, the shape of train_y: </span><span class="sc">{}</span><span class="st"> </span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(y_train_over.shape))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Before Oversampling, counts of label &#39;Yes&#39;: 976
Before Oversampling, counts of label &#39;No&#39;: 5099 

After Oversampling, counts of label &#39;Yes&#39;: 5099
After Oversampling, counts of label &#39;No&#39;: 5099 

After Oversampling, the shape of train_X: (10198, 29)
After Oversampling, the shape of train_y: (10198,) 

</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e5a457f5" class="cell code" id="e5a457f5"
data-outputId="d536979f-5c96-4b48-d7e9-9431f150d0f1">
<div class="sourceCode" id="cb97"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> []  <span class="co"># Empty list to store all the models</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Appending models into the list</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Logistic regression&quot;</span>, LogisticRegression(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Bagging&quot;</span>, BaggingClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Random forest&quot;</span>, RandomForestClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;GBM&quot;</span>, GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Adaboost&quot;</span>, AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Xgboost&quot;</span>, XGBClassifier(random_state<span class="op">=</span><span class="dv">1</span>, eval_metric<span class="op">=</span><span class="st">&quot;logloss&quot;</span>)))</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;dtree&quot;</span>, DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="st">&quot;Training Performance:&quot;</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models:</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train_over, y_train_over)</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> recall_score(y_train_over, model.predict(X_train_over))</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(name, scores))</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="st">&quot;Validation Performance:&quot;</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models:</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train_over, y_train_over)</span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> recall_score(y_val, model.predict(X_val))</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(name, scores))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
Training Performance:

Logistic regression: 0.8350656991566974
Bagging: 0.9974504804863699
Random forest: 1.0
GBM: 0.980976662090606
Adaboost: 0.9690135320651108
Xgboost: 1.0
dtree: 1.0

Validation Performance:

Logistic regression: 0.8251533742331288
Bagging: 0.8496932515337423
Random forest: 0.8680981595092024
GBM: 0.8926380368098159
Adaboost: 0.901840490797546
Xgboost: 0.8987730061349694
dtree: 0.8251533742331288
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="be5b2116" class="cell markdown" id="be5b2116">
<h3 id="performance-comparison">Performance comparison</h3>
<ul>
<li>Adaboost has the best performance on validation followed by XGB</li>
</ul>
</div>
<div id="62f1f452" class="cell markdown" id="62f1f452">
<h2 id="models-with-undersampled-data">Models with Undersampled
data</h2>
</div>
<div id="f3a65f4c" class="cell code" id="f3a65f4c"
data-outputId="f3c496fd-054e-4e1d-ad73-aecf734dff7a">
<div class="sourceCode" id="cb100"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>X_train_un, y_train_un <span class="op">=</span> rus.fit_resample(X_train, y_train)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="580b5abc" class="cell code" id="580b5abc"
data-outputId="c06acf8c-f0ca-4a07-dc89-9d30a37dccc5">
<div class="sourceCode" id="cb102"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Before Under Sampling, counts of label &#39;Yes&#39;: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">sum</span>(y_train <span class="op">==</span> <span class="dv">1</span>)))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Before Under Sampling, counts of label &#39;No&#39;: </span><span class="sc">{}</span><span class="st"> </span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">sum</span>(y_train <span class="op">==</span> <span class="dv">0</span>)))</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;After Under Sampling, counts of label &#39;Yes&#39;: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">sum</span>(y_train_un <span class="op">==</span> <span class="dv">1</span>)))</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;After Under Sampling, counts of label &#39;No&#39;: </span><span class="sc">{}</span><span class="st"> </span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="bu">sum</span>(y_train_un <span class="op">==</span> <span class="dv">0</span>)))</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;After Under Sampling, the shape of train_X: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(X_train_un.shape))</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;After Under Sampling, the shape of train_y: </span><span class="sc">{}</span><span class="st"> </span><span class="ch">\n</span><span class="st">&quot;</span>.<span class="bu">format</span>(y_train_un.shape))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Before Under Sampling, counts of label &#39;Yes&#39;: 976
Before Under Sampling, counts of label &#39;No&#39;: 5099 

After Under Sampling, counts of label &#39;Yes&#39;: 976
After Under Sampling, counts of label &#39;No&#39;: 976 

After Under Sampling, the shape of train_X: (1952, 29)
After Under Sampling, the shape of train_y: (1952,) 

</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e674701b" class="cell code" id="e674701b"
data-outputId="9f7e9c36-2f98-4693-f016-fdf5a57921d1">
<div class="sourceCode" id="cb105"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> []  <span class="co"># Empty list to store all the models</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Appending models into the list</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Logistic regression&quot;</span>, LogisticRegression(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Bagging&quot;</span>, BaggingClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Random forest&quot;</span>, RandomForestClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;GBM&quot;</span>, GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Adaboost&quot;</span>, AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;Xgboost&quot;</span>, XGBClassifier(random_state<span class="op">=</span><span class="dv">1</span>, eval_metric<span class="op">=</span><span class="st">&quot;logloss&quot;</span>)))</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>models.append((<span class="st">&quot;dtree&quot;</span>, DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="st">&quot;Training Performance:&quot;</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models:</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train_un, y_train_un)</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> recall_score(y_train_un, model.predict(X_train_un))</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(name, scores))</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="st">&quot;Validation Performance:&quot;</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models:</span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train_un, y_train_un)</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> recall_score(y_val, model.predict(X_val))</span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(name, scores))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
Training Performance:

Logistic regression: 0.8227459016393442
Bagging: 0.9907786885245902
Random forest: 1.0
GBM: 0.9805327868852459
Adaboost: 0.9528688524590164
Xgboost: 1.0
dtree: 1.0

Validation Performance:

Logistic regression: 0.8282208588957055
Bagging: 0.9294478527607362
Random forest: 0.9386503067484663
GBM: 0.9570552147239264
Adaboost: 0.9601226993865031
Xgboost: 0.9570552147239264
dtree: 0.9202453987730062
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="21d82749" class="cell markdown" id="21d82749">
<h3 id="performance-comparison">Performance comparison</h3>
<ul>
<li>Adaboost has the best performance followed by Xgboost as per the
validation performance</li>
</ul>
</div>
<div id="9e577895" class="cell markdown" id="9e577895">
<h2 id="which-models-should-be-tuned">Which models should be tuned?</h2>
<ul>
<li>XGBoost, AdaBoost and Gradient boosting models have consistent and
good performance for all 3 datasets.</li>
<li>So, we will tune these 3 models.</li>
<li>We will tune these 3 models using undersampled data as it is giving
better results</li>
<li>Sometimes models might overfit after undersampling and oversampling,
so it's better to tune models with both undersampled data and original
data</li>
</ul>
</div>
<div id="21e2a05a" class="cell markdown" id="21e2a05a">
<h2 id="tuning-xgboost">Tuning XGBoost</h2>
</div>
<div id="30cd5bc4" class="cell markdown" id="30cd5bc4">
<h3 id="tuning-with-undersampled-data">Tuning with Undersampled
data</h3>
</div>
<div id="5b47a548" class="cell code" id="5b47a548"
data-outputId="b6412f16-a37c-45d3-fb3c-d336554668c8">
<div class="sourceCode" id="cb108"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="co"># defining model</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>Model <span class="op">=</span> XGBClassifier(random_state<span class="op">=</span><span class="dv">1</span>,eval_metric<span class="op">=</span><span class="st">&#39;logloss&#39;</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Parameter grid to pass in RandomSearchCV</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>param_grid<span class="op">=</span>{<span class="st">&#39;n_estimators&#39;</span>:np.arange(<span class="dv">50</span>,<span class="dv">300</span>,<span class="dv">50</span>),<span class="st">&#39;scale_pos_weight&#39;</span>:[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">10</span>],</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;learning_rate&#39;</span>:[<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.05</span>], <span class="st">&#39;gamma&#39;</span>:[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>],</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;subsample&#39;</span>:[<span class="fl">0.7</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span>,<span class="dv">1</span>]</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>           }</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Type of scoring used to compare parameter combinations</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>scorer <span class="op">=</span> metrics.make_scorer(metrics.recall_score)</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Calling RandomizedSearchCV</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>randomized_cv <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>Model, param_distributions<span class="op">=</span>param_grid, n_iter<span class="op">=</span><span class="dv">50</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, scoring<span class="op">=</span>scorer, cv<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting parameters in RandomizedSearchCV</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>randomized_cv.fit(X_train_un,y_train_un)</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best parameters are </span><span class="sc">{}</span><span class="st"> with CV score=</span><span class="sc">{}</span><span class="st">:&quot;</span> .<span class="bu">format</span>(randomized_cv.best_params_,randomized_cv.best_score_))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best parameters are {&#39;subsample&#39;: 0.9, &#39;scale_pos_weight&#39;: 10, &#39;n_estimators&#39;: 200, &#39;learning_rate&#39;: 0.01, &#39;gamma&#39;: 1} with CV score=0.980559916274202:
Wall time: 31.5 s
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="05499eeb" class="cell code" id="05499eeb"
data-outputId="af34fc1f-7090-41bb-bba8-a6c3062abce4">
<div class="sourceCode" id="cb111"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>tuned_xgb1 <span class="op">=</span> XGBClassifier(</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    eval_metric<span class="op">=</span><span class="st">&quot;logloss&quot;</span>,</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    scale_pos_weight<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.01</span>,</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    gamma<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>tuned_xgb1.fit(X_train_un, y_train_un)</span></code></pre></div>
<div class="output execute_result" data-execution_count="50">
<pre><code>XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, enable_categorical=False,
              eval_metric=&#39;logloss&#39;, gamma=1, gpu_id=-1, importance_type=None,
              interaction_constraints=&#39;&#39;, learning_rate=0.01, max_delta_step=0,
              max_depth=6, min_child_weight=1, missing=nan,
              monotone_constraints=&#39;()&#39;, n_estimators=200, n_jobs=8,
              num_parallel_tree=1, predictor=&#39;auto&#39;, random_state=1,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=10, subsample=0.9,
              tree_method=&#39;exact&#39;, validate_parameters=1, verbosity=None)</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="b175c5ae" class="cell code" id="b175c5ae"
data-outputId="c72195f0-a95c-4137-f2a3-926e4584b677"
data-scrolled="false">
<div class="sourceCode" id="cb114"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on train set</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>xgb1_train <span class="op">=</span> model_performance_classification_sklearn(</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    tuned_xgb1, X_train_un, y_train_un</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>xgb1_train</span></code></pre></div>
<div class="output execute_result" data-execution_count="51">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.912</td>
      <td>1.000</td>
      <td>0.851</td>
      <td>0.919</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="50e5012b" class="cell code" id="50e5012b"
data-outputId="099c8596-6438-4304-defc-bbafb3d51638"
data-scrolled="true">
<div class="sourceCode" id="cb116"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on validation set</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>xgb1_val <span class="op">=</span> model_performance_classification_sklearn(tuned_xgb1, X_val, y_val)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>xgb1_val</span></code></pre></div>
<div class="output execute_result" data-execution_count="52">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.818</td>
      <td>0.988</td>
      <td>0.469</td>
      <td>0.636</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="08029ef1" class="cell markdown" id="08029ef1">
<h3 id="tuning-with-original-data">Tuning with Original data</h3>
</div>
<div id="816ce4b2" class="cell code" id="816ce4b2"
data-outputId="fb1be1bb-3708-4f98-82b1-e633ca047468">
<div class="sourceCode" id="cb118"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># defining model</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>Model <span class="op">=</span> XGBClassifier(random_state<span class="op">=</span><span class="dv">1</span>,eval_metric<span class="op">=</span><span class="st">&#39;logloss&#39;</span>)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Parameter grid to pass in RandomSearchCV</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>param_grid<span class="op">=</span>{<span class="st">&#39;n_estimators&#39;</span>:np.arange(<span class="dv">50</span>,<span class="dv">300</span>,<span class="dv">50</span>),<span class="st">&#39;scale_pos_weight&#39;</span>:[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">10</span>],</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;learning_rate&#39;</span>:[<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.05</span>], <span class="st">&#39;gamma&#39;</span>:[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>],</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;subsample&#39;</span>:[<span class="fl">0.7</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span>,<span class="dv">1</span>]</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>           }</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Type of scoring used to compare parameter combinations</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>scorer <span class="op">=</span> metrics.make_scorer(metrics.recall_score)</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Calling RandomizedSearchCV</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>randomized_cv <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>Model, param_distributions<span class="op">=</span>param_grid, n_iter<span class="op">=</span><span class="dv">50</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, scoring<span class="op">=</span>scorer, cv<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting parameters in RandomizedSearchCV</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>randomized_cv.fit(X_train,y_train)</span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best parameters are </span><span class="sc">{}</span><span class="st"> with CV score=</span><span class="sc">{}</span><span class="st">:&quot;</span> .<span class="bu">format</span>(randomized_cv.best_params_,randomized_cv.best_score_))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best parameters are {&#39;subsample&#39;: 0.9, &#39;scale_pos_weight&#39;: 10, &#39;n_estimators&#39;: 200, &#39;learning_rate&#39;: 0.01, &#39;gamma&#39;: 1} with CV score=0.9405442176870749:
Wall time: 1min 10s
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="58afd57e" class="cell code" id="58afd57e"
data-outputId="8856a98b-721f-4a74-ae6f-680189134a02">
<div class="sourceCode" id="cb121"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>tuned_xgb2 <span class="op">=</span> XGBClassifier(</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    eval_metric<span class="op">=</span><span class="st">&quot;logloss&quot;</span>,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>    scale_pos_weight<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.01</span>,</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>    gamma<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>tuned_xgb2.fit(X_train, y_train)</span></code></pre></div>
<div class="output execute_result" data-execution_count="54">
<pre><code>XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, enable_categorical=False,
              eval_metric=&#39;logloss&#39;, gamma=1, gpu_id=-1, importance_type=None,
              interaction_constraints=&#39;&#39;, learning_rate=0.01, max_delta_step=0,
              max_depth=6, min_child_weight=1, missing=nan,
              monotone_constraints=&#39;()&#39;, n_estimators=200, n_jobs=8,
              num_parallel_tree=1, predictor=&#39;auto&#39;, random_state=1,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=10, subsample=0.9,
              tree_method=&#39;exact&#39;, validate_parameters=1, verbosity=None)</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="bdce11a6" class="cell code" id="bdce11a6"
data-outputId="1071c7df-fd1b-4c3c-b115-239eb129b950"
data-scrolled="true">
<div class="sourceCode" id="cb124"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on training set</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>xgb2_train <span class="op">=</span> model_performance_classification_sklearn(tuned_xgb2, X_train, y_train)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>xgb2_train</span></code></pre></div>
<div class="output execute_result" data-execution_count="55">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.946</td>
      <td>0.999</td>
      <td>0.749</td>
      <td>0.856</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="d578a430" class="cell code" id="d578a430"
data-outputId="24e6026a-224b-4526-b69c-eaff8cd98c00">
<div class="sourceCode" id="cb126"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on validation set</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>xgb2_val <span class="op">=</span> model_performance_classification_sklearn(tuned_xgb2, X_val, y_val)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>xgb2_val</span></code></pre></div>
<div class="output execute_result" data-execution_count="56">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.930</td>
      <td>0.960</td>
      <td>0.710</td>
      <td>0.816</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="b1e1226b" class="cell markdown" id="b1e1226b">
<h2 id="tuning-adaboost">Tuning Adaboost</h2>
</div>
<div id="9f7bdeda" class="cell markdown" id="9f7bdeda">
<h3 id="tuning-with-undersampled-data">Tuning with Undersampled
data</h3>
</div>
<div id="d2b78bdc" class="cell code" id="d2b78bdc"
data-outputId="a49b1386-47a7-4a9a-a72d-5ec48c86c097">
<div class="sourceCode" id="cb128"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co"># defining model</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>Model <span class="op">=</span> AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter grid to pass in RandomSearchCV</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;n_estimators&quot;</span>: np.arange(<span class="dv">10</span>, <span class="dv">110</span>, <span class="dv">10</span>),</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;learning_rate&quot;</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>, <span class="fl">0.05</span>, <span class="dv">1</span>],</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;base_estimator&quot;</span>: [</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>        DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>        DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>        DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Type of scoring used to compare parameter combinations</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>scorer <span class="op">=</span> metrics.make_scorer(metrics.recall_score)</span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Calling RandomizedSearchCV</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>randomized_cv <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>Model, param_distributions<span class="op">=</span>param_grid, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, n_iter<span class="op">=</span><span class="dv">50</span>, scoring<span class="op">=</span>scorer, cv<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting parameters in RandomizedSearchCV</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>randomized_cv.fit(X_train_un,y_train_un)</span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best parameters are </span><span class="sc">{}</span><span class="st"> with CV score=</span><span class="sc">{}</span><span class="st">:&quot;</span> .<span class="bu">format</span>(randomized_cv.best_params_,randomized_cv.best_score_))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best parameters are {&#39;n_estimators&#39;: 90, &#39;learning_rate&#39;: 0.2, &#39;base_estimator&#39;: DecisionTreeClassifier(max_depth=3, random_state=1)} with CV score=0.949811616954474:
Wall time: 12.3 s
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="529e87ae" class="cell code" id="529e87ae"
data-outputId="542ea185-3728-444d-93e9-3f14d32d761d">
<div class="sourceCode" id="cb131"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>tuned_adb1 <span class="op">=</span> AdaBoostClassifier(</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">90</span>,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    base_estimator<span class="op">=</span>DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>tuned_adb1.fit(X_train_un, y_train_un)</span></code></pre></div>
<div class="output execute_result" data-execution_count="58">
<pre><code>AdaBoostClassifier(base_estimator=DecisionTreeClassifier(max_depth=3,
                                                         random_state=1),
                   learning_rate=0.2, n_estimators=90, random_state=1)</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="611d8e8c" class="cell code" id="611d8e8c"
data-outputId="e79c46be-bdbe-4e37-b64d-8b2729f6cd93"
data-scrolled="true">
<div class="sourceCode" id="cb134"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on training set</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>adb1_train <span class="op">=</span> model_performance_classification_sklearn(</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    tuned_adb1, X_train_un, y_train_un</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>adb1_train</span></code></pre></div>
<div class="output execute_result" data-execution_count="59">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000</td>
      <td>1.000</td>
      <td>1.000</td>
      <td>1.000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e1feaa38" class="cell code" id="e1feaa38"
data-outputId="5b1097dc-54b9-4e28-e3e5-f1c3dcb92a59"
data-scrolled="false">
<div class="sourceCode" id="cb136"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on validation set</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>adb1_val <span class="op">=</span> model_performance_classification_sklearn(tuned_adb1, X_val, y_val)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>adb1_val</span></code></pre></div>
<div class="output execute_result" data-execution_count="60">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.935</td>
      <td>0.963</td>
      <td>0.725</td>
      <td>0.827</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="5de10f42" class="cell markdown" id="5de10f42">
<h3 id="tuning-with-original-data">Tuning with Original data</h3>
</div>
<div id="7f179c6d" class="cell code" id="7f179c6d"
data-outputId="2c70ac11-07f9-4e6d-d88a-fd037a3bdb38">
<div class="sourceCode" id="cb138"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co"># defining model</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>Model <span class="op">=</span> AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter grid to pass in RandomSearchCV</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;n_estimators&quot;</span>: np.arange(<span class="dv">10</span>, <span class="dv">110</span>, <span class="dv">10</span>),</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;learning_rate&quot;</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>, <span class="fl">0.05</span>, <span class="dv">1</span>],</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;base_estimator&quot;</span>: [</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>        DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>        DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>        DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Type of scoring used to compare parameter combinations</span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>scorer <span class="op">=</span> metrics.make_scorer(metrics.recall_score)</span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Calling RandomizedSearchCV</span></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>randomized_cv <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>Model, param_distributions<span class="op">=</span>param_grid, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, n_iter<span class="op">=</span><span class="dv">50</span>, scoring<span class="op">=</span>scorer, cv<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting parameters in RandomizedSearchCV</span></span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>randomized_cv.fit(X_train,y_train)</span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best parameters are </span><span class="sc">{}</span><span class="st"> with CV score=</span><span class="sc">{}</span><span class="st">:&quot;</span> .<span class="bu">format</span>(randomized_cv.best_params_,randomized_cv.best_score_))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best parameters are {&#39;n_estimators&#39;: 90, &#39;learning_rate&#39;: 1, &#39;base_estimator&#39;: DecisionTreeClassifier(max_depth=2, random_state=1)} with CV score=0.8647409733124019:
Wall time: 30.2 s
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e3f25997" class="cell code" id="e3f25997"
data-outputId="ef2018ca-9134-4fc3-b963-ea236c8a4872">
<div class="sourceCode" id="cb141"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>tuned_adb2 <span class="op">=</span> AdaBoostClassifier(</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">90</span>,</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    base_estimator<span class="op">=</span>DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>tuned_adb2.fit(X_train, y_train)</span></code></pre></div>
<div class="output execute_result" data-execution_count="62">
<pre><code>AdaBoostClassifier(base_estimator=DecisionTreeClassifier(max_depth=3,
                                                         random_state=1),
                   learning_rate=0.2, n_estimators=90, random_state=1)</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="2eb30efe" class="cell code" id="2eb30efe"
data-outputId="dbb56217-05da-47a7-acd7-6d1b389c23bb"
data-scrolled="true">
<div class="sourceCode" id="cb144"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on training set</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>adb2_train <span class="op">=</span> model_performance_classification_sklearn(tuned_adb2, X_train, y_train)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>adb2_train</span></code></pre></div>
<div class="output execute_result" data-execution_count="63">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.992</td>
      <td>0.967</td>
      <td>0.982</td>
      <td>0.975</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="7dd549d6" class="cell code" id="7dd549d6"
data-outputId="9802f5b3-172c-489f-8cd2-55bc9387757b">
<div class="sourceCode" id="cb146"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on validation set</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>adb2_val <span class="op">=</span> model_performance_classification_sklearn(tuned_adb2, X_val, y_val)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>adb2_val</span></code></pre></div>
<div class="output execute_result" data-execution_count="64">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.969</td>
      <td>0.871</td>
      <td>0.934</td>
      <td>0.902</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="95f8e11e" class="cell markdown" id="95f8e11e">
<h2 id="tuning-gradient-boosting-classifier">Tuning Gradient Boosting
Classifier</h2>
</div>
<div id="f9882190" class="cell markdown" id="f9882190">
<h3 id="tuning-with-undersampled-data">Tuning with Undersampled
Data</h3>
</div>
<div id="a8619e93" class="cell code" id="a8619e93"
data-outputId="1dc11109-e12f-46ce-8143-2d1feaac3933">
<div class="sourceCode" id="cb148"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating pipeline</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>Model <span class="op">=</span> GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Parameter grid to pass in RandomSearchCV</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;init&quot;</span>: [AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>),DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">1</span>)],</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;n_estimators&quot;</span>: np.arange(<span class="dv">75</span>,<span class="dv">150</span>,<span class="dv">25</span>),</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;learning_rate&quot;</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>, <span class="fl">0.05</span>, <span class="dv">1</span>],</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;subsample&quot;</span>:[<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="dv">1</span>],</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;max_features&quot;</span>:[<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="dv">1</span>],</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Type of scoring used to compare parameter combinations</span></span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>scorer <span class="op">=</span> metrics.make_scorer(metrics.recall_score)</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Calling RandomizedSearchCV</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>randomized_cv <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>Model, param_distributions<span class="op">=</span>param_grid, n_iter<span class="op">=</span><span class="dv">50</span>, scoring<span class="op">=</span>scorer, cv<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">1</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting parameters in RandomizedSearchCV</span></span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>randomized_cv.fit(X_train_un,y_train_un)</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best parameters are </span><span class="sc">{}</span><span class="st"> with CV score=</span><span class="sc">{}</span><span class="st">:&quot;</span> .<span class="bu">format</span>(randomized_cv.best_params_,randomized_cv.best_score_))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best parameters are {&#39;subsample&#39;: 0.7, &#39;n_estimators&#39;: 125, &#39;max_features&#39;: 0.7, &#39;learning_rate&#39;: 0.2, &#39;init&#39;: AdaBoostClassifier(random_state=1)} with CV score=0.9559497645211932:
Wall time: 13 s
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="7b6cd986" class="cell code" id="7b6cd986"
data-outputId="a444021d-9ee0-43ec-fb9b-6821e10b10f6">
<div class="sourceCode" id="cb151"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>tuned_gbm1 <span class="op">=</span> GradientBoostingClassifier(</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">125</span>,</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    max_features<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    init<span class="op">=</span>AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>tuned_gbm1.fit(X_train_un, y_train_un)</span></code></pre></div>
<div class="output execute_result" data-execution_count="66">
<pre><code>GradientBoostingClassifier(init=AdaBoostClassifier(random_state=1),
                           learning_rate=0.2, max_features=0.7,
                           n_estimators=125, random_state=1, subsample=0.7)</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="c157254c" class="cell code" id="c157254c"
data-outputId="d204d5c2-4fd1-4dd0-d122-c4d0d7d60830"
data-scrolled="true">
<div class="sourceCode" id="cb154"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on training set</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>gbm1_train <span class="op">=</span> model_performance_classification_sklearn(</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>    tuned_gbm1, X_train_un, y_train_un</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>gbm1_train</span></code></pre></div>
<div class="output execute_result" data-execution_count="67">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.996</td>
      <td>0.998</td>
      <td>0.995</td>
      <td>0.996</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="f6759fa1" class="cell code" id="f6759fa1"
data-outputId="5f3312a6-1769-4f5f-d750-1328314df83e"
data-scrolled="true">
<div class="sourceCode" id="cb156"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on validation set</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>gbm1_val <span class="op">=</span> model_performance_classification_sklearn(tuned_gbm1, X_val, y_val)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>gbm1_val</span></code></pre></div>
<div class="output execute_result" data-execution_count="68">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.947</td>
      <td>0.954</td>
      <td>0.770</td>
      <td>0.852</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="4fe93810" class="cell markdown" id="4fe93810">
<h3 id="tuning-with-original-data">Tuning with Original data</h3>
</div>
<div id="d3e4048d" class="cell code" id="d3e4048d"
data-outputId="15cf3b49-12b4-4976-a7f7-9d8cfc7cc4f8">
<div class="sourceCode" id="cb158"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co">#defining model</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>Model <span class="op">=</span> GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Parameter grid to pass in RandomSearchCV</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;init&quot;</span>: [AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>),DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">1</span>)],</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;n_estimators&quot;</span>: np.arange(<span class="dv">75</span>,<span class="dv">150</span>,<span class="dv">25</span>),</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;learning_rate&quot;</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>, <span class="fl">0.05</span>, <span class="dv">1</span>],</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;subsample&quot;</span>:[<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="dv">1</span>],</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;max_features&quot;</span>:[<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="dv">1</span>],</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Type of scoring used to compare parameter combinations</span></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>scorer <span class="op">=</span> metrics.make_scorer(metrics.recall_score)</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Calling RandomizedSearchCV</span></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>randomized_cv <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>Model, param_distributions<span class="op">=</span>param_grid, n_iter<span class="op">=</span><span class="dv">50</span>, scoring<span class="op">=</span>scorer, cv<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">1</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting parameters in RandomizedSearchCV</span></span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>randomized_cv.fit(X_train,y_train)</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best parameters are </span><span class="sc">{}</span><span class="st"> with CV score=</span><span class="sc">{}</span><span class="st">:&quot;</span> .<span class="bu">format</span>(randomized_cv.best_params_,randomized_cv.best_score_))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best parameters are {&#39;subsample&#39;: 0.7, &#39;n_estimators&#39;: 125, &#39;max_features&#39;: 0.7, &#39;learning_rate&#39;: 0.2, &#39;init&#39;: AdaBoostClassifier(random_state=1)} with CV score=0.8544897959183672:
Wall time: 32.8 s
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="bd14de85" class="cell code" id="bd14de85"
data-outputId="71cc0ee3-f6e2-4f81-f7d1-8a82e8aea57b">
<div class="sourceCode" id="cb161"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>tuned_gbm2 <span class="op">=</span> GradientBoostingClassifier(</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">125</span>,</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>    max_features<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>    init<span class="op">=</span>AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>tuned_gbm2.fit(X_train, y_train)</span></code></pre></div>
<div class="output execute_result" data-execution_count="70">
<pre><code>GradientBoostingClassifier(init=AdaBoostClassifier(random_state=1),
                           learning_rate=0.2, max_features=0.7,
                           n_estimators=125, random_state=1, subsample=0.7)</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="1e6a125c" class="cell code" id="1e6a125c"
data-outputId="b0dc3364-9e6a-48ce-fe61-0180c9861f25"
data-scrolled="true">
<div class="sourceCode" id="cb164"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on training set</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>gbm2_train <span class="op">=</span> model_performance_classification_sklearn(tuned_gbm1, X_train, y_train)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>gbm2_train</span></code></pre></div>
<div class="output execute_result" data-execution_count="71">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.964</td>
      <td>0.998</td>
      <td>0.819</td>
      <td>0.900</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="ca232fee" class="cell code" id="ca232fee"
data-outputId="273d27df-04b8-4873-d4bd-3374d6060753"
data-scrolled="true">
<div class="sourceCode" id="cb166"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking model&#39;s performance on validation set</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>gbm2_val <span class="op">=</span> model_performance_classification_sklearn(tuned_gbm1, X_val, y_val)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>gbm2_val</span></code></pre></div>
<div class="output execute_result" data-execution_count="72">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.947</td>
      <td>0.954</td>
      <td>0.770</td>
      <td>0.852</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="872d02d7" class="cell markdown" id="872d02d7">
<h2 id="model-performance-comparison">Model Performance comparison</h2>
</div>
<div id="1c501f92" class="cell code" id="1c501f92"
data-outputId="d7aaf2f0-0d67-4f28-d2e8-2fa635c1266d">
<div class="sourceCode" id="cb168"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># training performance comparison</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>models_train_comp_df <span class="op">=</span> pd.concat(</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>        xgb1_train.T,</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>        xgb2_train.T,</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>        gbm1_train.T,</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>        gbm2_train.T,</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>        adb1_train.T,</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>        adb2_train.T,</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>models_train_comp_df.columns <span class="op">=</span> [</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;XGBoost trained with Undersampled data&quot;</span>,</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;XGBoost trained with Original data&quot;</span>,</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Gradient boosting trained with Undersampled data&quot;</span>,</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Gradient boosting trained with Original data&quot;</span>,</span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AdaBoost trained with Undersampled data&quot;</span>,</span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AdaBoost trained with Original data&quot;</span>,</span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Training performance comparison:&quot;</span>)</span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>models_train_comp_df</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Training performance comparison:
</code></pre>
</div>
<div class="output execute_result" data-execution_count="73">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>XGBoost trained with Undersampled data</th>
      <th>XGBoost trained with Original data</th>
      <th>Gradient boosting trained with Undersampled data</th>
      <th>Gradient boosting trained with Original data</th>
      <th>AdaBoost trained with Undersampled data</th>
      <th>AdaBoost trained with Original data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Accuracy</th>
      <td>0.912</td>
      <td>0.946</td>
      <td>0.996</td>
      <td>0.964</td>
      <td>1.000</td>
      <td>0.992</td>
    </tr>
    <tr>
      <th>Recall</th>
      <td>1.000</td>
      <td>0.999</td>
      <td>0.998</td>
      <td>0.998</td>
      <td>1.000</td>
      <td>0.967</td>
    </tr>
    <tr>
      <th>Precision</th>
      <td>0.851</td>
      <td>0.749</td>
      <td>0.995</td>
      <td>0.819</td>
      <td>1.000</td>
      <td>0.982</td>
    </tr>
    <tr>
      <th>F1</th>
      <td>0.919</td>
      <td>0.856</td>
      <td>0.996</td>
      <td>0.900</td>
      <td>1.000</td>
      <td>0.975</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="7efef13e" class="cell code" id="7efef13e"
data-outputId="76cc078f-4de5-4550-8c17-61b070ed731b">
<div class="sourceCode" id="cb171"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation performance comparison</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>models_train_comp_df <span class="op">=</span> pd.concat(</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>    [xgb1_val.T, xgb2_val.T, gbm1_val.T, gbm2_val.T, adb1_val.T, adb2_val.T], axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>models_train_comp_df.columns <span class="op">=</span> [</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;XGBoost trained with Undersampled data&quot;</span>,</span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;XGBoost trained with Original data&quot;</span>,</span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Gradient boosting trained with Undersampled data&quot;</span>,</span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Gradient boosting trained with Original data&quot;</span>,</span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AdaBoost trained with Undersampled data&quot;</span>,</span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AdaBoost trained with Original data&quot;</span>,</span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Validation performance comparison:&quot;</span>)</span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>models_train_comp_df</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Validation performance comparison:
</code></pre>
</div>
<div class="output execute_result" data-execution_count="74">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>XGBoost trained with Undersampled data</th>
      <th>XGBoost trained with Original data</th>
      <th>Gradient boosting trained with Undersampled data</th>
      <th>Gradient boosting trained with Original data</th>
      <th>AdaBoost trained with Undersampled data</th>
      <th>AdaBoost trained with Original data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Accuracy</th>
      <td>0.818</td>
      <td>0.930</td>
      <td>0.947</td>
      <td>0.947</td>
      <td>0.935</td>
      <td>0.969</td>
    </tr>
    <tr>
      <th>Recall</th>
      <td>0.988</td>
      <td>0.960</td>
      <td>0.954</td>
      <td>0.954</td>
      <td>0.963</td>
      <td>0.871</td>
    </tr>
    <tr>
      <th>Precision</th>
      <td>0.469</td>
      <td>0.710</td>
      <td>0.770</td>
      <td>0.770</td>
      <td>0.725</td>
      <td>0.934</td>
    </tr>
    <tr>
      <th>F1</th>
      <td>0.636</td>
      <td>0.816</td>
      <td>0.852</td>
      <td>0.852</td>
      <td>0.827</td>
      <td>0.902</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="fc2ad274" class="cell markdown" id="fc2ad274">
<ul>
<li>Gradient boosting model trained with original data has generalised
performance, so let's consider it as the best model.</li>
</ul>
</div>
<div id="e7326b66" class="cell code" id="e7326b66"
data-outputId="333f06bb-6535-4578-ebbf-11f718242ee5">
<div class="sourceCode" id="cb174"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s check the performance on test set</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>gbm2_test <span class="op">=</span> model_performance_classification_sklearn(tuned_gbm2, X_test, y_test)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>gbm2_test</span></code></pre></div>
<div class="output execute_result" data-execution_count="75">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Recall</th>
      <th>Precision</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.975</td>
      <td>0.914</td>
      <td>0.931</td>
      <td>0.922</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="a13c9a36" class="cell markdown" id="a13c9a36">
<ul>
<li>The model has given good performance on test set.</li>
</ul>
</div>
<div id="ba8a19b1" class="cell code" id="ba8a19b1"
data-outputId="d7264ffb-252d-4d59-9cf4-305677b3b6fb">
<div class="sourceCode" id="cb176"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> X_train.columns</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> tuned_gbm2.feature_importances_</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> np.argsort(importances)</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Feature Importances&quot;</span>)</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>plt.barh(<span class="bu">range</span>(<span class="bu">len</span>(indices)), importances[indices], color<span class="op">=</span><span class="st">&quot;violet&quot;</span>, align<span class="op">=</span><span class="st">&quot;center&quot;</span>)</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(indices)), [feature_names[i] <span class="cf">for</span> i <span class="kw">in</span> indices])</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Relative Importance&quot;</span>)</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/594539f6bac736891d16982b095556a79e993f51.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="3a389046" class="cell markdown" id="3a389046">
<ul>
<li>Total_Trans_Amt is the most important variable in predicting credit
card churn followed by Total_Revolving_Bal, Total_Trans_Ct,
Total_Relationship_Count, and Total_Ct_Chng_Q4_Q1.</li>
</ul>
</div>
<div id="dafff525" class="cell markdown" id="dafff525">
<h2 id="lets-use-column-transformer-to-build-the-final-model">Let's use
Column Transformer to build the final model</h2>
<ul>
<li><p>We will create 2 different pipelines, one for numerical columns
and one for categorical columns</p></li>
<li><p>For numerical columns, we will do missing value imputation as
pre-processing</p></li>
<li><p>For categorical columns, we will do one hot encoding and missing
value imputation as pre-processing</p></li>
<li><p>We are doing missing value imputation for the whole data, so that
if there is any missing value in the data in future that can be taken
care of.</p></li>
</ul>
</div>
<div id="8f95efaa" class="cell code" id="8f95efaa"
data-outputId="29cbf372-17ca-4bbd-87bf-c5f464e4eff9">
<div class="sourceCode" id="cb178"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a list of numerical variables</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>numerical_features <span class="op">=</span> [</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">&#39;Customer_Age&#39;</span>, <span class="st">&#39;Months_on_book&#39;</span>,</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Total_Relationship_Count&#39;</span>, <span class="st">&#39;Months_Inactive_12_mon&#39;</span>,</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Contacts_Count_12_mon&#39;</span>, <span class="st">&#39;Credit_Limit&#39;</span>, <span class="st">&#39;Total_Revolving_Bal&#39;</span>,</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Avg_Open_To_Buy&#39;</span>, <span class="st">&#39;Total_Amt_Chng_Q4_Q1&#39;</span>, <span class="st">&#39;Total_Trans_Amt&#39;</span>,</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Total_Trans_Ct&#39;</span>, <span class="st">&#39;Total_Ct_Chng_Q4_Q1&#39;</span>, <span class="st">&#39;Avg_Utilization_Ratio&#39;</span>]</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a transformer for numerical variables, which will apply simple imputer on the numerical variables</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>numeric_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">&quot;imputer&quot;</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">&quot;median&quot;</span>))])</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a list of categorical variables</span></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">&#39;Gender&#39;</span>,</span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Dependent_count&#39;</span>, <span class="st">&#39;Education_Level&#39;</span>, <span class="st">&#39;Marital_Status&#39;</span>,</span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Income_Category&#39;</span>, <span class="st">&#39;Card_Category&#39;</span>]</span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a transformer for categorical variables, which will first apply simple imputer and </span></span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a><span class="co">#then do one hot encoding for categorical variables</span></span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a>categorical_transformer <span class="op">=</span> Pipeline(</span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>    steps<span class="op">=</span>[</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;imputer&quot;</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">&quot;most_frequent&quot;</span>)),</span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;onehot&quot;</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">&quot;ignore&quot;</span>)),</span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a><span class="co"># handle_unknown = &quot;ignore&quot;, allows model to handle any unknown category in the test data</span></span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combining categorical transformer and numerical transformer using a column transformer</span></span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb178-31"><a href="#cb178-31" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb178-32"><a href="#cb178-32" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;num&quot;</span>, numeric_transformer, numerical_features),</span>
<span id="cb178-33"><a href="#cb178-33" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;cat&quot;</span>, categorical_transformer, categorical_features),</span>
<span id="cb178-34"><a href="#cb178-34" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb178-35"><a href="#cb178-35" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">&quot;drop&quot;</span>,</span>
<span id="cb178-36"><a href="#cb178-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb178-37"><a href="#cb178-37" aria-hidden="true" tabindex="-1"></a><span class="co"># remainder = &quot;drop&quot; has been used, it will drop the variables that are not present in &quot;numerical_features&quot; </span></span>
<span id="cb178-38"><a href="#cb178-38" aria-hidden="true" tabindex="-1"></a><span class="co"># and &quot;categorical_features&quot; </span></span>
<span id="cb178-39"><a href="#cb178-39" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="b967d6c2" class="cell code" id="b967d6c2"
data-outputId="ba627584-1154-4d39-84b5-07cb1ca7f1bb">
<div class="sourceCode" id="cb180"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separating target variable and other variables</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> churn.drop(columns<span class="op">=</span><span class="st">&quot;Attrition_Flag&quot;</span>)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> churn[<span class="st">&quot;Attrition_Flag&quot;</span>]</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="c0df1bfb" class="cell markdown" id="c0df1bfb">
<ul>
<li>Let's first do some basic pre-processing</li>
</ul>
</div>
<div id="60554757" class="cell code" id="&quot;60554757&quot;"
data-outputId="ca239600-e5bb-45f5-900d-f0684ba1eaeb">
<div class="sourceCode" id="cb182"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CLIENTNUM consists of uniques ID for clients and hence will not add value to the modeling</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>X.drop([<span class="st">&quot;CLIENTNUM&quot;</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e1755659" class="cell code" id="e1755659"
data-outputId="71055cec-1152-466c-e385-bd1e2f48b198">
<div class="sourceCode" id="cb184"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>X[<span class="st">&quot;Income_Category&quot;</span>].replace(<span class="st">&quot;abc&quot;</span>, np.nan, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="722d16fd" class="cell code" id="722d16fd"
data-outputId="c5268bf8-3e09-4077-9687-aa73c93deec6">
<div class="sourceCode" id="cb186"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Encoding Existing and Attrited customers to 0 and 1 respectively, for analysis.</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>Y.replace(<span class="st">&quot;Existing Customer&quot;</span>, <span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>Y.replace(<span class="st">&quot;Attrited Customer&quot;</span>, <span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="d4b1a94b" class="cell markdown" id="d4b1a94b">
<ul>
<li>Now we already know the best model we need to process with, so we
don't need to divide data into 3 parts</li>
</ul>
</div>
<div id="4bf96564" class="cell code" id="4bf96564"
data-outputId="87957ecf-7dbc-4280-d2db-88cb11b55074">
<div class="sourceCode" id="cb188"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into train and test sets</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    X, Y, test_size<span class="op">=</span><span class="fl">0.30</span>, random_state<span class="op">=</span><span class="dv">1</span>, stratify<span class="op">=</span>Y</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape, X_test.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(7088, 19) (3039, 19)
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="c551f4c1" class="cell code" id="c551f4c1"
data-outputId="f083d9e9-011f-4295-86f8-5c21eb134dd8">
<div class="sourceCode" id="cb191"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating new pipeline with best parameters</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Pipeline(</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    steps<span class="op">=</span>[</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;pre&quot;</span>, preprocessor),</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;GBM&quot;</span>,</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>            GradientBoostingClassifier(</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>                random_state<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>                subsample<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>                n_estimators<span class="op">=</span><span class="dv">125</span>,</span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>                max_features<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>                learning_rate<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>                init<span class="op">=</span>AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model on training data</span></span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span></code></pre></div>
<div class="output execute_result" data-execution_count="83">
<pre><code>Pipeline(steps=[(&#39;pre&#39;,
                 ColumnTransformer(transformers=[(&#39;num&#39;,
                                                  Pipeline(steps=[(&#39;imputer&#39;,
                                                                   SimpleImputer(strategy=&#39;median&#39;))]),
                                                  [&#39;Customer_Age&#39;,
                                                   &#39;Months_on_book&#39;,
                                                   &#39;Total_Relationship_Count&#39;,
                                                   &#39;Months_Inactive_12_mon&#39;,
                                                   &#39;Contacts_Count_12_mon&#39;,
                                                   &#39;Credit_Limit&#39;,
                                                   &#39;Total_Revolving_Bal&#39;,
                                                   &#39;Avg_Open_To_Buy&#39;,
                                                   &#39;Total_Amt_Chng_Q4_Q1&#39;,
                                                   &#39;Total_Trans_Amt&#39;,
                                                   &#39;Total_Trans_Ct&#39;,
                                                   &#39;To...
                                                                   SimpleImputer(strategy=&#39;most_frequent&#39;)),
                                                                  (&#39;onehot&#39;,
                                                                   OneHotEncoder(handle_unknown=&#39;ignore&#39;))]),
                                                  [&#39;Gender&#39;, &#39;Dependent_count&#39;,
                                                   &#39;Education_Level&#39;,
                                                   &#39;Marital_Status&#39;,
                                                   &#39;Income_Category&#39;,
                                                   &#39;Card_Category&#39;])])),
                (&#39;GBM&#39;,
                 GradientBoostingClassifier(init=AdaBoostClassifier(random_state=1),
                                            learning_rate=0.2, max_features=0.7,
                                            n_estimators=125, random_state=1,
                                            subsample=0.7))])</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="de59074c" class="cell markdown" id="de59074c">
<h2 id="business-recommendations">Business Recommendations</h2>
</div>
<div id="49abf7e7" class="cell markdown" id="49abf7e7">
<ul>
<li><p>We have been able to build a predictive model:</p>
<p>a) that bank can deploy this model to identify customers who are at
the risk of attrition.</p>
<p>b) that the bank can use to find the key causes that drive
attrition.</p>
<p>c) based on which bank can take appropriate actions to build better
retention policies for customers.</p></li>
<li><p>Factors that drive the attrition - Total_Trans_Ct,
Total_Revolving_Bal, Total_Trans_Amt, Total_Relationship_Count</p></li>
<li><p>Total_Trans_Ct: Less number of transactions in a year leads to
attrition of a customer - to increase the usage of cards the bank can
provide offers like cashback, special discounts on the purchase of
something, etc so that customers feel motivated to use their
cards.</p></li>
<li><p>Total_Revolving_Bal: Customers with less total revolving balance
are the ones who attrited, such customers must have cleared their dues
and opted out of the credit card service. After the customer has cleared
the dues bank can ask for feedback on their experience and get to the
cause of attrition.</p></li>
<li><p>Total_Trans_Amt: Less number of transactions can lead to less
transaction amount and eventually leads to customer attrition - Bank can
provide offers on the purchase of costlier items which in turn will
benefit the customers and bank both.</p></li>
<li><p>Total_Relationship_Count: Attrition is highest among the
customers who are using 1 or 2 products offered by the bank - together
they constitute ~55% of the attrition - Bank should investigate here to
find the problems customers are facing with these products, customer
support, or more transparency can help in retaining customers.</p></li>
<li><p>Female customers should be the target customers for any kind of
marketing campaign as they are the ones who utilize their credits, make
more and higher amount transactions. But their credit limit is less so
increasing the credit limit for such customers can profit the
bank.</p></li>
<li><p>Months_Inactive: As inactivity increases the attrition also
increases, 2-4 months of inactivity are the biggest contributors of
attrition -Bank can send automated messages to engage customers, these
messages can be about their monthly activity, new offers or services,
etc.</p></li>
<li><p>Highest attrition is among the customers who interacted/reached
out the most with/to the bank, This indicates that the bank is not able
to resolve the problems faced by customers leading to attrition - a
feedback collection system can be set up to check if the customers are
satisfied with the resolution provided, if not, the bank should act upon
it accordingly.</p></li>
</ul>
</div>
<div id="717485d7" class="cell markdown" id="717485d7">
<h2 id="appendix"><a id='link1'>Appendix</a></h2>
</div>
<div id="1f10ce0d" class="cell markdown" id="1f10ce0d">
<h2 id="eda">EDA</h2>
</div>
<div id="1dc3b68a" class="cell markdown" id="1dc3b68a">
<h3 id="univariate-analysis">Univariate analysis</h3>
</div>
<div id="d3bc33c9" class="cell code" id="d3bc33c9"
data-outputId="1ff3c809-83ce-4125-fd39-d83b687100ca">
<div class="sourceCode" id="cb194"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to plot a boxplot and a histogram along the same scale.</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> histogram_boxplot(data, feature, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>), kde<span class="op">=</span><span class="va">False</span>, bins<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Boxplot and histogram combined</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="co">    data: dataframe</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="co">    feature: dataframe column</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="co">    figsize: size of figure (default (12,7))</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="co">    kde: whether to the show density curve (default False)</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="co">    bins: number of bins for histogram (default None)</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>    f2, (ax_box2, ax_hist2) <span class="op">=</span> plt.subplots(</span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a>        nrows<span class="op">=</span><span class="dv">2</span>,  <span class="co"># Number of rows of the subplot grid= 2</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>        sharex<span class="op">=</span><span class="va">True</span>,  <span class="co"># x-axis will be shared among all subplots</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>        gridspec_kw<span class="op">=</span>{<span class="st">&quot;height_ratios&quot;</span>: (<span class="fl">0.25</span>, <span class="fl">0.75</span>)},</span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>        figsize<span class="op">=</span>figsize,</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># creating the 2 subplots</span></span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(</span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data, x<span class="op">=</span>feature, ax<span class="op">=</span>ax_box2, showmeans<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&quot;violet&quot;</span></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># boxplot will be created and a star will indicate the mean value of the column</span></span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a>    sns.histplot(</span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data, x<span class="op">=</span>feature, kde<span class="op">=</span>kde, ax<span class="op">=</span>ax_hist2, bins<span class="op">=</span>bins, palette<span class="op">=</span><span class="st">&quot;winter&quot;</span></span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="cf">if</span> bins <span class="cf">else</span> sns.histplot(</span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data, x<span class="op">=</span>feature, kde<span class="op">=</span>kde, ax<span class="op">=</span>ax_hist2</span>
<span id="cb194-27"><a href="#cb194-27" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># For histogram</span></span>
<span id="cb194-28"><a href="#cb194-28" aria-hidden="true" tabindex="-1"></a>    ax_hist2.axvline(</span>
<span id="cb194-29"><a href="#cb194-29" aria-hidden="true" tabindex="-1"></a>        data[feature].mean(), color<span class="op">=</span><span class="st">&quot;green&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span></span>
<span id="cb194-30"><a href="#cb194-30" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># Add mean to the histogram</span></span>
<span id="cb194-31"><a href="#cb194-31" aria-hidden="true" tabindex="-1"></a>    ax_hist2.axvline(</span>
<span id="cb194-32"><a href="#cb194-32" aria-hidden="true" tabindex="-1"></a>        data[feature].median(), color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;-&quot;</span></span>
<span id="cb194-33"><a href="#cb194-33" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># Add median to the histogram</span></span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="ffc0455f" class="cell markdown" id="ffc0455f">
<h3 id="observations-on-customer_age">Observations on Customer_Age</h3>
</div>
<div id="e6b68e86" class="cell code" id="e6b68e86"
data-outputId="2c47d8d1-09d1-475b-e23a-30e17a9abc3b">
<div class="sourceCode" id="cb196"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Customer_Age&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/5307ca957bb9f964475202e042c52fa1d43a4149.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="b8a7b9b5" class="cell markdown" id="b8a7b9b5">
<ul>
<li>The distribution of Customer_Age is normally distributed with mean
and median at 46 years.</li>
<li>From the boxplot, we can see that there are a few outliers.</li>
</ul>
</div>
<div id="3ca6494b" class="cell markdown" id="3ca6494b">
<h3 id="observations-on-months_on_book">Observations on
Months_on_book</h3>
</div>
<div id="e81f2d9b" class="cell code" id="e81f2d9b"
data-outputId="783864ae-c1eb-4819-f045-88714539a1ed">
<div class="sourceCode" id="cb198"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Months_on_book&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/2748ae97b80b884ff8b7bac0ece28f0a5900c0dd.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="0c4c6360" class="cell markdown" id="0c4c6360">
<ul>
<li>Most customers are with the bank for 3 years.</li>
<li>From the boxplot, we can see that there are outliers on both sides
of the whiskers.</li>
</ul>
</div>
<div id="9d06764f" class="cell markdown" id="9d06764f">
<h3 id="observations-on-credit_limit">Observations on Credit_Limit</h3>
</div>
<div id="cac5108b" class="cell code" id="cac5108b"
data-outputId="f7997b40-025a-47a5-8b4c-96ce2367fd83">
<div class="sourceCode" id="cb200"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Credit_Limit&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/c88290179e4d31ac932799a082bd2efcf0a94c96.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="9dd39b0c" class="cell markdown" id="9dd39b0c">
<ul>
<li>The distribution of the Credit_Limit is skewed to the right.</li>
<li>There are quite a few customers with a maximum Credit Limit of
35000.</li>
<li>50% of the customers of the bank have a credit limit of less than
&lt;5000.</li>
</ul>
</div>
<div id="a8326f8c" class="cell markdown" id="a8326f8c">
<h3 id="observations-on-total_revolving_bal">Observations on
Total_Revolving_Bal</h3>
</div>
<div id="7bb1ed06" class="cell code" id="7bb1ed06"
data-outputId="2b153822-999c-4a03-b193-1a4a6453a0b3">
<div class="sourceCode" id="cb202"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Total_Revolving_Bal&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/440c0478cdbedd44937aa1af670d3d57ec4281a5.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="9e10273a" class="cell markdown" id="9e10273a">
<ul>
<li>Most customers pay the complete dues of credit card and have 0
revolving balance.</li>
<li>There are quite a few customers with a revolving balance of
2500.</li>
</ul>
</div>
<div id="d2c4c61c" class="cell markdown" id="d2c4c61c">
<h3 id="observations-on-avg_open_to_buy">Observations on
Avg_Open_To_Buy</h3>
</div>
<div id="765c5078" class="cell code" id="765c5078"
data-outputId="c42cd8a8-40ba-47a0-e61e-174223b08ac0">
<div class="sourceCode" id="cb204"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Avg_Open_To_Buy&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/c1a5d5d07a85b05a4bdd51baa01b59b54c1740dc.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="1b880193" class="cell markdown" id="1b880193">
<ul>
<li>The distribution of the Avg_Open_To_Buy column is right-skewed.</li>
<li>A right-skewed distribution indicates that most customers used a big
part of their limit while only a few customers (on the right tail) were
left with a majority of their credit amount.</li>
</ul>
</div>
<div id="a73589a3" class="cell markdown" id="a73589a3">
<h3 id="observations-on-total_trans_ct">Observations on
Total_Trans_Ct</h3>
</div>
<div id="dcfc26ff" class="cell code" id="dcfc26ff"
data-outputId="047a3915-2988-4b64-df1c-7dec2f0c4a5b">
<div class="sourceCode" id="cb206"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Total_Trans_Ct&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/873563f7394546c46aa95ed62d5c622a4799560b.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="ea7eb05e" class="cell markdown" id="ea7eb05e">
<ul>
<li>The distribution of Total_Trans_Ct shows two peaks on 40 and 80
transactions in a year which indicates that customers used credit cards
3 to 6 times a month to make transactions.</li>
</ul>
</div>
<div id="27cd3efb" class="cell markdown" id="27cd3efb">
<h3 id="observations-on-total_amt_chng_q4_q1">Observations on
Total_Amt_Chng_Q4_Q1</h3>
</div>
<div id="c3857afa" class="cell code" id="c3857afa"
data-outputId="07aa53ef-7611-4b02-84fb-07f2d7e81782">
<div class="sourceCode" id="cb208"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Total_Amt_Chng_Q4_Q1&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/88a19ccdf4dc57d65fd76c7fa1a58693773c1f19.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="59909eca" class="cell markdown" id="59909eca">
<ul>
<li>The distribution of Total_Amt_Chng_Q4_Q1 looks normally distributed
but there's a slight skew towards the right.</li>
<li>From the boxplot, we can see that there are outliers on both sides
of the whiskers.</li>
</ul>
</div>
<div id="c5785044" class="cell markdown" id="c5785044">
<h3 id="observations-on-total_trans_amt">Observations on
Total_Trans_Amt</h3>
</div>
<div id="73379efd" class="cell code" id="73379efd"
data-outputId="43d6d763-500b-4aeb-c138-8d194b6a5f0b">
<div class="sourceCode" id="cb210"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Total_Trans_Amt&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/3c9b9587e80c382546dea70965095a336df1cc03.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="f59d7f9e" class="cell markdown" id="f59d7f9e">
<ul>
<li>The distribution of Total_Trans_Amt is skewed to the right.</li>
<li>There are two peaks in data at total transaction amounts of one
around 2500 and the second around the mean value of ~4500.</li>
<li>From the boxplot, we can see that there are outliers - customers
with more than ~8000 total transaction amounts are being considered as
outliers.</li>
<li>It would be interesting to check if the customers spending less with
the card are the ones churning or the ones spending more are churning,
if the latter is the case then there is a problem for the bank as it is
losing valuable customers.</li>
</ul>
</div>
<div id="e466b3fa" class="cell markdown" id="e466b3fa">
<h3 id="observations-on-total_ct_chng_q4_q1">Observations on
Total_Ct_Chng_Q4_Q1</h3>
</div>
<div id="23ea0658" class="cell code" id="23ea0658"
data-outputId="b2dd4e60-edd6-452a-edcc-8da3cff04631">
<div class="sourceCode" id="cb212"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Total_Ct_Chng_Q4_Q1&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/edbc052ef72828f0b9bfa78a91d8133116e9cb0e.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e3403265" class="cell markdown" id="e3403265">
<ul>
<li>The distribution of Total_Ct_Chng_Q4_Q1 looks normally distributed
but there's a slight skew towards the right.</li>
<li>From the boxplot, we can see that there are outliers on both sides
of the whiskers.</li>
</ul>
</div>
<div id="4fd578a1" class="cell markdown" id="4fd578a1">
<h3 id="observations-on-avg_utilization_ratio">Observations on
Avg_Utilization_Ratio</h3>
</div>
<div id="3f429b86" class="cell code" id="3f429b86"
data-outputId="a54dfeaf-4d58-4327-b208-7c564452b08f">
<div class="sourceCode" id="cb214"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>histogram_boxplot(data, <span class="st">&quot;Avg_Utilization_Ratio&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/ffc94f5bc791b11822b18ce288876633214346d3.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="275f064f" class="cell markdown" id="275f064f">
<ul>
<li>The distribution of Avg_Utilization_Ratio is skewed to the
right.</li>
<li>This distribution is not a positive sign for the bank as most of the
customers are not utilizing their credit amount.</li>
</ul>
</div>
<div id="5dfde5c3" class="cell markdown" id="5dfde5c3">
<p><strong>Credit limit, Average open to buy and Average utilization
ratio are right-skewed</strong></p>
<ol>
<li>Open to buy means how much credit a customer is left with
<ul>
<li>Low values of Open to buy could represent either
<ul>
<li>Customers have low credit limits</li>
<li>Customers are spending a lot so they are left less open to buy</li>
</ul></li>
</ul></li>
<li>Average utilization ratio = (1 - (open to buy/credit limit))
<ul>
<li>Low values of the Average utilization ratio represents
<ul>
<li>(Open to buy/credit limit) is nearly equal to 1 -&gt; Open to buy is
nearly equal to the credit limit -&gt; customers are spending less using
their credit cards</li>
</ul></li>
</ul></li>
<li>Credit limit is also right-skewed which represents - most of the
customers have low credit limits</li>
</ol>
<p>Looking at the 3 variables, we can conclude that most of the
customers have low credit limits and are not utilizing their credit
cards much</p>
<p>Now this statement justifies the right skewness for all 3
variables</p>
</div>
<div id="f0abf1a3" class="cell code" id="f0abf1a3"
data-outputId="a5414639-5e3e-457f-9032-bdc6968be932">
<div class="sourceCode" id="cb216"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to create labeled barplots</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> labeled_barplot(data, feature, perc<span class="op">=</span><span class="va">False</span>, n<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Barplot with percentage at the top</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a><span class="co">    data: dataframe</span></span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a><span class="co">    feature: dataframe column</span></span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a><span class="co">    perc: whether to display percentages instead of count (default is False)</span></span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a><span class="co">    n: displays the top n category levels (default is None, i.e., display all levels)</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="bu">len</span>(data[feature])  <span class="co"># length of the column</span></span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> data[feature].nunique()</span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(count <span class="op">+</span> <span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(n <span class="op">+</span> <span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.countplot(</span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data,</span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>feature,</span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span><span class="st">&quot;Paired&quot;</span>,</span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a>        order<span class="op">=</span>data[feature].value_counts().index[:n].sort_values(),</span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb216-28"><a href="#cb216-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-29"><a href="#cb216-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> ax.patches:</span>
<span id="cb216-30"><a href="#cb216-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> perc <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb216-31"><a href="#cb216-31" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> <span class="st">&quot;</span><span class="sc">{:.1f}</span><span class="st">%&quot;</span>.<span class="bu">format</span>(</span>
<span id="cb216-32"><a href="#cb216-32" aria-hidden="true" tabindex="-1"></a>                <span class="dv">100</span> <span class="op">*</span> p.get_height() <span class="op">/</span> total</span>
<span id="cb216-33"><a href="#cb216-33" aria-hidden="true" tabindex="-1"></a>            )  <span class="co"># percentage of each class of the category</span></span>
<span id="cb216-34"><a href="#cb216-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb216-35"><a href="#cb216-35" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> p.get_height()  <span class="co"># count of each level of the category</span></span>
<span id="cb216-36"><a href="#cb216-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-37"><a href="#cb216-37" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="dv">2</span>  <span class="co"># width of the plot</span></span>
<span id="cb216-38"><a href="#cb216-38" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> p.get_height()  <span class="co"># height of the plot</span></span>
<span id="cb216-39"><a href="#cb216-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-40"><a href="#cb216-40" aria-hidden="true" tabindex="-1"></a>        ax.annotate(</span>
<span id="cb216-41"><a href="#cb216-41" aria-hidden="true" tabindex="-1"></a>            label,</span>
<span id="cb216-42"><a href="#cb216-42" aria-hidden="true" tabindex="-1"></a>            (x, y),</span>
<span id="cb216-43"><a href="#cb216-43" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">&quot;center&quot;</span>,</span>
<span id="cb216-44"><a href="#cb216-44" aria-hidden="true" tabindex="-1"></a>            va<span class="op">=</span><span class="st">&quot;center&quot;</span>,</span>
<span id="cb216-45"><a href="#cb216-45" aria-hidden="true" tabindex="-1"></a>            size<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb216-46"><a href="#cb216-46" aria-hidden="true" tabindex="-1"></a>            xytext<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb216-47"><a href="#cb216-47" aria-hidden="true" tabindex="-1"></a>            textcoords<span class="op">=</span><span class="st">&quot;offset points&quot;</span>,</span>
<span id="cb216-48"><a href="#cb216-48" aria-hidden="true" tabindex="-1"></a>        )  <span class="co"># annotate the percentage</span></span>
<span id="cb216-49"><a href="#cb216-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-50"><a href="#cb216-50" aria-hidden="true" tabindex="-1"></a>    plt.show()  <span class="co"># show the plot</span></span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="295fa20f" class="cell markdown" id="295fa20f">
<h3 id="observations-on-dependent_count">Observations on
Dependent_count</h3>
</div>
<div id="29f3f84b" class="cell code" id="29f3f84b"
data-outputId="05df5a16-8e63-453a-e387-1b602a0e3aea">
<div class="sourceCode" id="cb218"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Dependent_count&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/756cec3e82000c14f2f9c3ae2976a203b119e1bd.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="9721cb08" class="cell markdown" id="9721cb08">
<ul>
<li>The distribution of dependents is very realistic with most customers
having 2 or 3 dependents.</li>
</ul>
</div>
<div id="5dda0f24" class="cell markdown" id="5dda0f24">
<h3 id="observations-on-total_relationship_count">Observations on
Total_Relationship_Count</h3>
</div>
<div id="3cbde4c0" class="cell code" id="3cbde4c0"
data-outputId="8b3a9695-ae9f-4d0c-97ef-1c0bab1270bd">
<div class="sourceCode" id="cb220"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Total_Relationship_Count&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/d7b62b97161b3ec10ae0da09517179448b8a91cc.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="11120782" class="cell markdown" id="&quot;11120782&quot;">
<ul>
<li>22.8% of the customers are using 3 products offered by the bank
while an equal percentage ~19% of customers use 4 or more than 4
products.</li>
<li>Equal percentage of customers using 4,5 and 6 products might suggest
that customers who opt or buy the 4th product will also be ready to buy
more products.</li>
</ul>
</div>
<div id="01e2bad1" class="cell markdown" id="01e2bad1">
<h3 id="observations-on-months_inactive_12_mon">Observations on
Months_Inactive_12_mon</h3>
</div>
<div id="ff02277a" class="cell code" id="ff02277a"
data-outputId="af59eb0f-1af4-40a0-c0f6-3df3fd8e5c66">
<div class="sourceCode" id="cb222"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Months_Inactive_12_mon&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/02ce597291afcfb551a9e130cae8a9568095380c.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="4a826387" class="cell markdown" id="4a826387">
<ul>
<li>Only 7.5% of the customers were inactive for more than 3
months.</li>
</ul>
</div>
<div id="5cb94e1c" class="cell markdown" id="5cb94e1c">
<h3 id="observations-on-contacts_count_12_mon">Observations on
Contacts_Count_12_mon</h3>
</div>
<div id="71e423b7" class="cell code" id="71e423b7"
data-outputId="4f7aacf0-965f-4ae9-f80f-b33de40dcb3a">
<div class="sourceCode" id="cb224"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Contacts_Count_12_mon&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/c6578db313ad116aee11b69a84f1e53babfeaa9a.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="f6252fef" class="cell markdown" id="f6252fef">
<ul>
<li>~16% of the customers interacted with the bank more than 3 times in
the past 12 months.</li>
</ul>
</div>
<div id="2f329e65" class="cell markdown" id="2f329e65">
<h3 id="observations-on-gender">Observations on Gender</h3>
</div>
<div id="ba281446" class="cell code" id="ba281446"
data-outputId="c8bf0537-d286-41df-8502-14431713807a">
<div class="sourceCode" id="cb226"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Gender&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/eca68fb7546535532b94eac1b3b2d268500befaf.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="07837a20" class="cell markdown" id="07837a20">
<ul>
<li>We have an almost equal percentage of Male and Female
customers.</li>
</ul>
</div>
<div id="4bc68ba4" class="cell markdown" id="4bc68ba4">
<h3 id="observations-on-education_level">Observations on
Education_Level</h3>
</div>
<div id="8a198dbe" class="cell code" id="8a198dbe"
data-outputId="f5badae8-fd5e-426a-8b57-08c85b15e539">
<div class="sourceCode" id="cb228"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Education_Level&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/676dba431e820095b278d63d55648aedbd6094c3.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="18f89e93" class="cell markdown" id="18f89e93">
<ul>
<li>30.9% of the customers are graduates, followed by 19.9% of the
customers who completed high school.</li>
<li>Percentage of missing value in Education_Level column - 15%.</li>
</ul>
</div>
<div id="930ad721" class="cell markdown" id="930ad721">
<h3 id="observations-on-marital_status">Observations on
Marital_Status</h3>
</div>
<div id="fbb2babd" class="cell code" id="fbb2babd"
data-outputId="3e5426e6-b61f-4d93-b360-5ef57eb63554">
<div class="sourceCode" id="cb230"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Marital_Status&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/909bc7d04c41408db0c98db75ee6be899f80dfbb.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e4c8ada6" class="cell markdown" id="e4c8ada6">
<ul>
<li>46.3% of the customers are Married, followed by 38.9% of Single
customers.</li>
<li>Percentage of missing value in Marital_Status column - 7.4%.</li>
</ul>
</div>
<div id="1b6ee942" class="cell markdown" id="1b6ee942">
<h3 id="observations-on-income_category">Observations on
Income_Category</h3>
</div>
<div id="4e456033" class="cell code" id="4e456033"
data-outputId="7fc0e4c7-c610-4b37-b16f-bba3db1915ca">
<div class="sourceCode" id="cb232"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Income_Category&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/3387ca0fd043467776fe700dfd4dcfedc38df875.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="7306d918" class="cell markdown" id="7306d918">
<ul>
<li>35.2% of the customers lie in the Less than 40k income category
group, followed by 17.7% of the customers in the 40k-60k income
group.</li>
<li>Percentage of missing value in Income_Category column - 11%.</li>
</ul>
</div>
<div id="42981112" class="cell markdown" id="&quot;42981112&quot;">
<h3 id="observations-on-card_category">Observations on
Card_Category</h3>
</div>
<div id="c10eba02" class="cell code" id="c10eba02"
data-outputId="3c0d8922-cccb-4aa1-dd45-3224f9f49c56">
<div class="sourceCode" id="cb234"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Card_Category&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/e6e1ef3dea3c336a3564323543552a5daf1c8edd.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="373134b9" class="cell markdown" id="373134b9">
<ul>
<li>93.2% of the customers have the Blue card.</li>
<li>Blue card would be a standard card given by the bank to all its
customers.</li>
</ul>
</div>
<div id="0cc9e14a" class="cell markdown" id="0cc9e14a">
<h3 id="observations-on-attrition_flag">Observations on
Attrition_Flag</h3>
</div>
<div id="e0850668" class="cell code" id="e0850668"
data-outputId="ede774e9-0dce-41ad-e4e5-ff1d6d1c2317">
<div class="sourceCode" id="cb236"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>labeled_barplot(data, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/70ac9d00a96f63adeb2906d499eda7b3ba0fef6f.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="1c48ca15" class="cell markdown" id="1c48ca15">
<ul>
<li>16.1% of the customers attrited.</li>
<li>This indicates an imbalance in the data.</li>
</ul>
</div>
<div id="7d6991e6" class="cell markdown" id="7d6991e6">
<h2 id="bivariate-analysis">Bivariate Analysis</h2>
</div>
<div id="1c87e9d3" class="cell code" id="1c87e9d3"
data-outputId="5828949c-8fcc-4b98-aafd-47be2c9dcf53">
<div class="sourceCode" id="cb238"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">7</span>))</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(data.corr(), annot<span class="op">=</span><span class="va">True</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, fmt<span class="op">=</span><span class="st">&quot;.2f&quot;</span>, cmap<span class="op">=</span><span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/b1d5e3fc539a09fe0bbb46530898daf34081781f.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="c528a3ef" class="cell markdown" id="c528a3ef">
<ul>
<li>Attrition_Flag shows a bit of a negative correlation with
Total_Trans_Ct (total transactions) and Total_Trans_Amt (total
transaction amount).</li>
<li>There's a strong positive correlation between Months_on_book and
Customer_Age, Total_Revolving_Bal and Avg_Utilization_Ratio,
Total_Trans_Amt and Total_Trans_Ct.</li>
<li>There's a negative correlation of Total_Relationship_count with
Total_Trans_Amt and Total_Trans_Ct, Avg_Utilization_Ratio with
Credit_Limit and Avg_Open_To_Buy.</li>
</ul>
</div>
<div id="4bb46199" class="cell code" id="4bb46199"
data-outputId="d13d454b-fb9d-4c29-8f20-0def8fcbbe71">
<div class="sourceCode" id="cb240"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to plot stacked bar chart</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stacked_barplot(data, predictor, target):</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Print the category counts and plot a stacked bar chart</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a><span class="co">    data: dataframe</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="co">    predictor: independent variable</span></span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a><span class="co">    target: target variable</span></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> data[predictor].nunique()</span>
<span id="cb240-13"><a href="#cb240-13" aria-hidden="true" tabindex="-1"></a>    sorter <span class="op">=</span> data[target].value_counts().index[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb240-14"><a href="#cb240-14" aria-hidden="true" tabindex="-1"></a>    tab1 <span class="op">=</span> pd.crosstab(data[predictor], data[target], margins<span class="op">=</span><span class="va">True</span>).sort_values(</span>
<span id="cb240-15"><a href="#cb240-15" aria-hidden="true" tabindex="-1"></a>        by<span class="op">=</span>sorter, ascending<span class="op">=</span><span class="va">False</span></span>
<span id="cb240-16"><a href="#cb240-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb240-17"><a href="#cb240-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tab1)</span>
<span id="cb240-18"><a href="#cb240-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">120</span>)</span>
<span id="cb240-19"><a href="#cb240-19" aria-hidden="true" tabindex="-1"></a>    tab <span class="op">=</span> pd.crosstab(data[predictor], data[target], normalize<span class="op">=</span><span class="st">&quot;index&quot;</span>).sort_values(</span>
<span id="cb240-20"><a href="#cb240-20" aria-hidden="true" tabindex="-1"></a>        by<span class="op">=</span>sorter, ascending<span class="op">=</span><span class="va">False</span></span>
<span id="cb240-21"><a href="#cb240-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb240-22"><a href="#cb240-22" aria-hidden="true" tabindex="-1"></a>    tab.plot(kind<span class="op">=</span><span class="st">&quot;bar&quot;</span>, stacked<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(count <span class="op">+</span> <span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb240-23"><a href="#cb240-23" aria-hidden="true" tabindex="-1"></a>    plt.legend(</span>
<span id="cb240-24"><a href="#cb240-24" aria-hidden="true" tabindex="-1"></a>        loc<span class="op">=</span><span class="st">&quot;lower left&quot;</span>, frameon<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb240-25"><a href="#cb240-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb240-26"><a href="#cb240-26" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">&quot;upper left&quot;</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb240-27"><a href="#cb240-27" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="03581d8c" class="cell markdown" id="03581d8c">
<h3 id="attrition_flag-vs-gender">Attrition_Flag vs Gender</h3>
</div>
<div id="bc548bd8" class="cell code" id="bc548bd8"
data-outputId="c9d6cf56-4a32-435c-d8e4-e7c34ef9fff0">
<div class="sourceCode" id="cb242"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Gender&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag     0     1    All
Gender                           
All             8500  1627  10127
F               4428   930   5358
M               4072   697   4769
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/cc49ddf589451e5eb9e0ce6fff5f274957f2fd93.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="d7246356" class="cell markdown" id="d7246356">
<ul>
<li>There's not much difference in attrition percentages for Males and
Females.</li>
<li>~20% of both Males and Females attrite.</li>
</ul>
</div>
<div id="bf38fa2c" class="cell markdown" id="bf38fa2c">
<h3 id="attrition_flag-vs-marital_status">Attrition_Flag vs
Marital_Status</h3>
</div>
<div id="dc572a96" class="cell code" id="dc572a96"
data-outputId="09b7c952-04e7-41a2-ba84-20fdfff4a1f3">
<div class="sourceCode" id="cb245"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Marital_Status&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag     0     1   All
Marital_Status                  
All             7880  1498  9378
Married         3978   709  4687
Single          3275   668  3943
Divorced         627   121   748
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/dfbc356d4c8d3f147e7cd5eca0cb5fbcd579d160.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="9aa17772" class="cell markdown" id="9aa17772">
<ul>
<li>There's not much difference in attrition percentages for
Marital_Status.</li>
<li>~20% of Singles, Divorced attrite.</li>
<li>Married customers attrite the least.</li>
</ul>
</div>
<div id="6c4cc487" class="cell markdown" id="6c4cc487">
<h3 id="attrition_flag-vs-education_level">Attrition_Flag vs
Education_Level</h3>
</div>
<div id="7031646f" class="cell code" id="7031646f"
data-outputId="f4fb4dea-f61e-411b-9b5a-e9954a43de99">
<div class="sourceCode" id="cb248"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Education_Level&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag      0     1   All
Education_Level                  
All              7237  1371  8608
Graduate         2641   487  3128
High School      1707   306  2013
Uneducated       1250   237  1487
College           859   154  1013
Doctorate         356    95   451
Post-Graduate     424    92   516
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/6c9e0e1292da3ef903046092ff9be5411cb925c6.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="246516ca" class="cell markdown" id="246516ca">
<ul>
<li>Customers with higher education - Doctorates and Post Graduates are
the ones most(~20% for both education levels) attriting.</li>
</ul>
</div>
<div id="0b6ad507" class="cell markdown" id="0b6ad507">
<h3 id="attrition_flag-vs-income_category">Attrition_Flag vs
Income_Category</h3>
</div>
<div id="d8032230" class="cell code" id="d8032230"
data-outputId="75306a20-4674-4b8c-e5cf-a7c8903e1103">
<div class="sourceCode" id="cb251"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Income_Category&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag      0     1    All
Income_Category                   
All              8500  1627  10127
Less than $40K   2949   612   3561
$40K - $60K      1519   271   1790
$80K - $120K     1293   242   1535
$60K - $80K      1213   189   1402
abc               925   187   1112
$120K +           601   126    727
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/212e022e1d2ae411a55f7d1f820c308081a2d64c.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="80183171" class="cell markdown" id="&quot;80183171&quot;">
<ul>
<li>The customers from two extreme income groups - Earning less than 40K
and Earning more than 120k+ are the ones attriting the most.</li>
</ul>
</div>
<div id="6fbe49ef" class="cell markdown" id="6fbe49ef">
<h3 id="attrition_flag-vs-card_category">Attrition_Flag vs
Card_Category</h3>
</div>
<div id="542e04a5" class="cell code" id="542e04a5"
data-outputId="f1d00622-3b77-47a9-d32a-2f30ca871620">
<div class="sourceCode" id="cb254"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Card_Category&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag     0     1    All
Card_Category                    
All             8500  1627  10127
Blue            7917  1519   9436
Silver           473    82    555
Gold              95    21    116
Platinum          15     5     20
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/bf03ae88e63491a6761d1597e429f12de86628ae.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="7a35fb4e" class="cell markdown" id="7a35fb4e">
<ul>
<li>~35% of attrition is amongst the customers with platinum cards
followed by ~30% attrition in Gold cards.</li>
<li>Customers with Platinum and Gold cards are our premium customers and
the highest attrition for these customers is alarming as they are using
the premium card provided by the bank.</li>
</ul>
</div>
<div id="83bbc106" class="cell markdown" id="83bbc106">
<h3 id="attrition_flag-vs-contacts_count_12_mon">Attrition_Flag vs
Contacts_Count_12_mon</h3>
</div>
<div id="9bcd424a" class="cell code" id="9bcd424a"
data-outputId="c47a4474-35af-459e-8eb4-b84e9488a590">
<div class="sourceCode" id="cb257"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Contacts_Count_12_mon&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag            0     1    All
Contacts_Count_12_mon                   
All                    8500  1627  10127
3                      2699   681   3380
2                      2824   403   3227
4                      1077   315   1392
1                      1391   108   1499
5                       117    59    176
6                         0    54     54
0                       392     7    399
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/7fdeb1556dbb71422e66c39e64d4b675eb1e994c.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="5c11d5f2" class="cell markdown" id="5c11d5f2">
<ul>
<li>Highest attrition is among the customers who interacted the most
with the bank.</li>
<li>This signifies that the bank is not able to resolve the problems
faced by customers leading to attrition</li>
<li>A preliminary step to identify attriting customers would be to look
out for customers who have reached out to them repeatedly.</li>
</ul>
</div>
<div id="3b6ba17a" class="cell markdown" id="3b6ba17a">
<h3 id="attrition_flag-vs-months_inactive_12_mon">Attrition_Flag vs
Months_Inactive_12_mon</h3>
</div>
<div id="ae0ad682" class="cell code" id="ae0ad682"
data-outputId="f81beaaa-1eee-4d52-e03c-f156de5c40e7">
<div class="sourceCode" id="cb260"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Months_Inactive_12_mon&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag             0     1    All
Months_Inactive_12_mon                   
All                     8500  1627  10127
3                       3020   826   3846
2                       2777   505   3282
4                        305   130    435
1                       2133   100   2233
5                        146    32    178
6                        105    19    124
0                         14    15     29
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/2678388ed61c271b26a583d8eeb790deae2d4e26.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="047f00a0" class="cell markdown" id="047f00a0">
<ul>
<li>As inactivity increases attrition also increases (2-4 months)</li>
<li>The interpretation from here for 0 months and 6 months is difficult
as customers who recently used the card attrited the most while those
who were inactive for 6 months attrited less.</li>
</ul>
</div>
<div id="26911836" class="cell markdown" id="&quot;26911836&quot;">
<h3 id="attrition_flag-vs-total_relationship_count">Attrition_Flag vs
Total_Relationship_Count</h3>
</div>
<div id="0abdd9ab" class="cell code" id="0abdd9ab"
data-outputId="75f84f9e-95a0-4f93-b37e-2b43bb6ea2ea">
<div class="sourceCode" id="cb263"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Total_Relationship_Count&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag               0     1    All
Total_Relationship_Count                   
All                       8500  1627  10127
3                         1905   400   2305
2                          897   346   1243
1                          677   233    910
5                         1664   227   1891
4                         1687   225   1912
6                         1670   196   1866
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/482006d7fe3f88c23cf0655a56a953628a6d6e8d.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="b867b6c6" class="cell markdown" id="b867b6c6">
<ul>
<li>Attrition is highest among the customers who are using 1 or 2
products offered by the bank - together they constitute ~55% of the
attrition.</li>
<li>Customers who use more than 3 products are the ones least attriting,
such customers might be more financially stable and actively invest in
different services provided by the bank.</li>
</ul>
</div>
<div id="756364bb" class="cell markdown" id="756364bb">
<h3 id="attrition_flag-vs-dependent_count">Attrition_Flag vs
Dependent_count</h3>
</div>
<div id="6d2d0a7c" class="cell code" id="6d2d0a7c"
data-outputId="8b82cad6-95a3-4395-b385-190f3289d3d7">
<div class="sourceCode" id="cb266"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>stacked_barplot(data, <span class="st">&quot;Dependent_count&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Attrition_Flag      0     1    All
Dependent_count                   
All              8500  1627  10127
3                2250   482   2732
2                2238   417   2655
1                1569   269   1838
4                1314   260   1574
0                 769   135    904
5                 360    64    424
------------------------------------------------------------------------------------------------------------------------
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/c8bf8af4a8d78855d3c11004733574de02f2b5a0.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="c5110b68" class="cell markdown" id="c5110b68">
<ul>
<li>More the number of dependents more is the attrition, more
responsibilities might lead to financial instability in such
customers.</li>
<li>Attrition is fairly low for customers with 0 or 1 dependents.</li>
</ul>
</div>
<div id="eb2c6763" class="cell code" id="eb2c6763"
data-outputId="1031396f-1a9f-46e1-e15d-8f42f8a139b6">
<div class="sourceCode" id="cb269"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co">### Function to plot distributions</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> distribution_plot_wrt_target(data, predictor, target):</span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a>    target_uniq <span class="op">=</span> data[target].unique()</span>
<span id="cb269-9"><a href="#cb269-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-10"><a href="#cb269-10" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">&quot;Distribution of target for target=&quot;</span> <span class="op">+</span> <span class="bu">str</span>(target_uniq[<span class="dv">0</span>]))</span>
<span id="cb269-11"><a href="#cb269-11" aria-hidden="true" tabindex="-1"></a>    sns.histplot(</span>
<span id="cb269-12"><a href="#cb269-12" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data[data[target] <span class="op">==</span> target_uniq[<span class="dv">0</span>]],</span>
<span id="cb269-13"><a href="#cb269-13" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>predictor,</span>
<span id="cb269-14"><a href="#cb269-14" aria-hidden="true" tabindex="-1"></a>        kde<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb269-15"><a href="#cb269-15" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>axs[<span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb269-16"><a href="#cb269-16" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">&quot;teal&quot;</span>,</span>
<span id="cb269-17"><a href="#cb269-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb269-18"><a href="#cb269-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-19"><a href="#cb269-19" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">&quot;Distribution of target for target=&quot;</span> <span class="op">+</span> <span class="bu">str</span>(target_uniq[<span class="dv">1</span>]))</span>
<span id="cb269-20"><a href="#cb269-20" aria-hidden="true" tabindex="-1"></a>    sns.histplot(</span>
<span id="cb269-21"><a href="#cb269-21" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data[data[target] <span class="op">==</span> target_uniq[<span class="dv">1</span>]],</span>
<span id="cb269-22"><a href="#cb269-22" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>predictor,</span>
<span id="cb269-23"><a href="#cb269-23" aria-hidden="true" tabindex="-1"></a>        kde<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb269-24"><a href="#cb269-24" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>axs[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb269-25"><a href="#cb269-25" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">&quot;orange&quot;</span>,</span>
<span id="cb269-26"><a href="#cb269-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb269-27"><a href="#cb269-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-28"><a href="#cb269-28" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">&quot;Boxplot w.r.t target&quot;</span>)</span>
<span id="cb269-29"><a href="#cb269-29" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(data<span class="op">=</span>data, x<span class="op">=</span>target, y<span class="op">=</span>predictor, ax<span class="op">=</span>axs[<span class="dv">1</span>, <span class="dv">0</span>], palette<span class="op">=</span><span class="st">&quot;gist_rainbow&quot;</span>)</span>
<span id="cb269-30"><a href="#cb269-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-31"><a href="#cb269-31" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">&quot;Boxplot (without outliers) w.r.t target&quot;</span>)</span>
<span id="cb269-32"><a href="#cb269-32" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(</span>
<span id="cb269-33"><a href="#cb269-33" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data,</span>
<span id="cb269-34"><a href="#cb269-34" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>target,</span>
<span id="cb269-35"><a href="#cb269-35" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>predictor,</span>
<span id="cb269-36"><a href="#cb269-36" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>axs[<span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb269-37"><a href="#cb269-37" aria-hidden="true" tabindex="-1"></a>        showfliers<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb269-38"><a href="#cb269-38" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span><span class="st">&quot;gist_rainbow&quot;</span>,</span>
<span id="cb269-39"><a href="#cb269-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb269-40"><a href="#cb269-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-41"><a href="#cb269-41" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb269-42"><a href="#cb269-42" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="51ac94be" class="cell markdown" id="51ac94be">
<h3 id="attrition_flag-vs-customer_age">Attrition_Flag vs
Customer_Age</h3>
</div>
<div id="8f24dccd" class="cell code" id="8f24dccd"
data-outputId="4aea02d6-6d3f-4295-8bd7-972e3695e842">
<div class="sourceCode" id="cb271"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Customer_Age&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/4eb4f83e72016743d6b8c763f30149c2581c4ae7.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="66a6619a" class="cell markdown" id="66a6619a">
<ul>
<li>There's no difference in the age of customers who attrited and who
didn't.</li>
</ul>
</div>
<div id="4e5ff101" class="cell markdown" id="4e5ff101">
<h3 id="attrition_flag-vs-months_on_book">Attrition_Flag vs
Months_on_book</h3>
</div>
<div id="c2e4f27d" class="cell code" id="c2e4f27d"
data-outputId="652f4f80-1e91-4a2e-dc3d-7421cc107347">
<div class="sourceCode" id="cb273"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Months_on_book&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/b33b374764dae99f3e0ad7546a9790661743ad73.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="8c6bb50c" class="cell markdown" id="8c6bb50c">
<ul>
<li>Tenure of relationship with the bank doesn't seem to have an impact
on attrition.</li>
</ul>
</div>
<div id="fb73a113" class="cell markdown" id="fb73a113">
<h3 id="attrition_flag-vs-credit_limit">Attrition_Flag vs
Credit_Limit</h3>
</div>
<div id="84358b2a" class="cell code" id="84358b2a"
data-outputId="d018b73e-a071-4795-bd13-a4881ee2f196">
<div class="sourceCode" id="cb275"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Credit_Limit&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/ed723cf164baa6380568ce4dc7f40b0a50bf25c2.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="8ac9464a" class="cell markdown" id="8ac9464a">
<ul>
<li>Customers with lower credit limits are the ones who attrited.</li>
</ul>
</div>
<div id="5ce92e94" class="cell markdown" id="5ce92e94">
<h3 id="attrition_flag-vs-total_revolving_bal">Attrition_Flag vs
Total_Revolving_Bal</h3>
</div>
<div id="a87a288d" class="cell code" id="a87a288d"
data-outputId="edde8773-0ebf-4210-a4fc-93e7d45778fc">
<div class="sourceCode" id="cb277"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Revolving_Bal&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/f34ec07f5acce3e6435cf34f871e2f49a4a1de7d.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="4b8d744e" class="cell markdown" id="4b8d744e">
<ul>
<li>Customers with less total revolving balance are the ones who
attrited, such customers must have cleared their dues and opted out of
the credit card service.</li>
</ul>
</div>
<div id="2753aeeb" class="cell markdown" id="2753aeeb">
<h3 id="attrition_flag-vs-avg_open_to_buy">Attrition_Flag vs
Avg_Open_To_Buy</h3>
</div>
<div id="063eb917" class="cell code" id="063eb917"
data-outputId="cf28ff63-7899-448b-c083-d86ddb24a1d8">
<div class="sourceCode" id="cb279"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Avg_Open_To_Buy&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/ccfbbba6c345acee65787e59da62cb999b4e9700.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="3f4221f8" class="cell markdown" id="3f4221f8">
<ul>
<li>There's not much difference in the distribution for an attrited and
existing customer.</li>
</ul>
</div>
<div id="4187d3d0" class="cell markdown" id="4187d3d0">
<h3 id="attrition_flag-vs-total_trans_ct">Attrition_Flag vs
Total_Trans_Ct</h3>
</div>
<div id="ba78c35a" class="cell code" id="ba78c35a"
data-outputId="018e4cb3-b57f-4fbc-a327-d249163dfbe2">
<div class="sourceCode" id="cb281"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Trans_Ct&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/d8243cba0a9260340ffcf2103ec9b7450f0934af.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="018e8426" class="cell markdown" id="018e8426">
<ul>
<li>Less number of transactions lead to higher attrition.</li>
<li>Customers with less than 80 to 100 transactions (or median
transactions equal to 40) in a year should be more focused upon.</li>
</ul>
</div>
<div id="57af9fd8" class="cell markdown" id="57af9fd8">
<h3 id="attrition_flag-vs-total_trans_amt">Attrition_Flag vs
Total_Trans_Amt</h3>
</div>
<div id="98682ef4" class="cell code" id="98682ef4"
data-outputId="d34e88fe-4bf1-4c22-d972-a8d6fd25e45b">
<div class="sourceCode" id="cb283"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Trans_Amt&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/e30e0aec9b6480f3aabd7e76c1779d3619fefb4c.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="66fbc12f" class="cell markdown" id="66fbc12f">
<ul>
<li>Less number of transactions might lead to a less transaction amount
and eventually leading to customer attrition.</li>
</ul>
</div>
<div id="dc8cb001" class="cell markdown" id="dc8cb001">
<h3 id="attrition_flag-vs-total_amt_chng_q4_q1">Attrition_Flag vs
Total_Amt_Chng_Q4_Q1</h3>
</div>
<div id="e0602737" class="cell code" id="e0602737"
data-outputId="c0d791e5-a073-41e4-b60e-901d46b24907">
<div class="sourceCode" id="cb285"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Amt_Chng_Q4_Q1&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/65953e1ad917386f13b902146023c97a419b37db.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="705820d7" class="cell markdown" id="705820d7">
<ul>
<li>Customers who didn't attrite showed less variability across Q4 to Q1
as compared to the ones who attrited.</li>
</ul>
</div>
<div id="080af0b2" class="cell markdown" id="080af0b2">
<h3 id="attrition_flag-vs-total_ct_chng_q4_q1">Attrition_Flag vs
Total_Ct_Chng_Q4_Q1</h3>
</div>
<div id="73f50dba" class="cell code" id="73f50dba"
data-outputId="2ce48662-ff1b-4736-a641-7200ac4f0d41">
<div class="sourceCode" id="cb287"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Total_Ct_Chng_Q4_Q1&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/15747953bbc77d2a26c4dd6aa435cdaab73c8f31.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="a13b8d8f" class="cell markdown" id="a13b8d8f">
<ul>
<li>Customers who didn't attrite showed less variability across Q4 to Q1
as compared to the ones who attrited.</li>
</ul>
</div>
<div id="3b1cca3f" class="cell markdown" id="3b1cca3f">
<h3 id="attrition_flag-vs-avg_utilization_ratio">Attrition_Flag vs
Avg_Utilization_Ratio</h3>
</div>
<div id="882a5ab0" class="cell code" id="882a5ab0"
data-outputId="13dce2e4-39c9-4791-9306-3fecbadc2516">
<div class="sourceCode" id="cb289"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>distribution_plot_wrt_target(data, <span class="st">&quot;Avg_Utilization_Ratio&quot;</span>, <span class="st">&quot;Attrition_Flag&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/572d1e3cbdeb86aafc801820a0274b7abe6e1b67.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="0949ab2a" class="cell markdown" id="0949ab2a">
<ul>
<li>Customers utilizing their full credit limit are the ones who didn't
attrite.</li>
<li>Less utilization of the available credits indicates inactivity of
customers.</li>
</ul>
</div>
<div id="9d41c7c8" class="cell code" id="9d41c7c8"
data-outputId="770d6219-94be-4a87-aad8-1105a7c69ede">
<div class="sourceCode" id="cb291"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> data[</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;Credit_Limit&quot;</span>, <span class="st">&quot;Total_Trans_Amt&quot;</span>, <span class="st">&quot;Avg_Utilization_Ratio&quot;</span>]</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>].columns.tolist()</span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, variable <span class="kw">in</span> <span class="bu">enumerate</span>(cols):</span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(data[<span class="st">&quot;Customer_Age&quot;</span>], data[variable], hue<span class="op">=</span>data[<span class="st">&quot;Gender&quot;</span>], ci<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb291-8"><a href="#cb291-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb291-9"><a href="#cb291-9" aria-hidden="true" tabindex="-1"></a>    plt.title(variable)</span>
<span id="cb291-10"><a href="#cb291-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_a8ddf29ee3614b86bcc7ace82f140d5e/a21929e72b827086ed8e2ac4d5711ada1ed100d8.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
</div>
</div>
<div id="e496633c" class="cell markdown" id="e496633c">
<ul>
<li>With age the credit limit of male customers increased (till 50
years) but for the female customers the credit limit constant
throughout.</li>
<li>Although the credit limit for female customers is less the total
transactions made by them for all age groups is the same.</li>
<li>Female customers utilized their credits more as compared to the male
customers where utilization dropped from 30-50 years but increased after
60 years.</li>
</ul>
</div>
<div id="7fea5898" class="cell markdown" id="7fea5898">
<h3 id="to-jump-back-to-the-eda-summary-section-click-here">To jump back
to the EDA summary section, click <a href="#eda">here</a>.</h3>
</div>
</body>
</html>
